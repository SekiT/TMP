!function(){"use strict";var t=t=>({get:e=>t.get(e),set:(e,n)=>(t.set(e,n),n)});const e=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,n=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,i=/<[a-z][^>]+$/i,r=/>[^<>]*$/,a=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/gi,o=/\s+$/,s=(t,e)=>0<e--&&(i.test(t[e])||!r.test(t[e])&&s(t,e)),l=(t,e,i)=>n.test(e)?t:`<${e}${i.replace(o,"")}></${e}>`;const{isArray:d}=Array,{indexOf:c,slice:p}=[],u=(t,e)=>111===t.nodeType?1/e<0?e?(({firstChild:t,lastChild:e})=>{const n=document.createRange();return n.setStartAfter(t),n.setEndAfter(e),n.deleteContents(),t})(t):t.lastChild:e?t.valueOf():t.firstChild:t;
/*! (c) Andrea Giammarchi - ISC */
var h=function(t){var e="content"in i("template")?function(t){var e=i("template");return e.innerHTML=t,e.content}:function(t){var e=i("fragment"),r=i("template"),a=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(t)){var o=RegExp.$1;r.innerHTML="<table>"+t+"</table>",a=r.querySelectorAll(o)}else r.innerHTML=t,a=r.childNodes;return n(e,a),e};return function(t,n){return("svg"===n?r:e)(t)};function n(t,e){for(var n=e.length;n--;)t.appendChild(e[0])}function i(e){return"fragment"===e?t.createDocumentFragment():t.createElementNS("http://www.w3.org/1999/xhtml",e)}function r(t){var e=i("fragment"),r=i("div");return r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t+"</svg>",n(e,r.firstChild.childNodes),e}}(document);const m=({childNodes:t},e)=>t[e],g=t=>{const e=[];let{parentNode:n}=t;for(;n;)e.push(c.call(n.childNodes,t)),n=(t=n).parentNode;return e},{createTreeWalker:f,importNode:x}=document,b=1!=x.length,$=b?(t,e)=>x.call(document,h(t,e),!0):h,y=b?t=>f.call(document,t,129,null,!1):t=>f.call(document,t,129),v=(t,e,n)=>((t,e,n,i,r)=>{const a=n.length;let o=e.length,s=a,l=0,d=0,c=null;for(;l<o||d<s;)if(o===l){const e=s<a?d?i(n[d-1],-0).nextSibling:i(n[s-d],0):r;for(;d<s;)t.insertBefore(i(n[d++],1),e)}else if(s===d)for(;l<o;)c&&c.has(e[l])||t.removeChild(i(e[l],-1)),l++;else if(e[l]===n[d])l++,d++;else if(e[o-1]===n[s-1])o--,s--;else if(e[l]===n[s-1]&&n[d]===e[o-1]){const r=i(e[--o],-1).nextSibling;t.insertBefore(i(n[d++],1),i(e[l++],-1).nextSibling),t.insertBefore(i(n[--s],1),r),e[o]=n[s]}else{if(!c){c=new Map;let t=d;for(;t<s;)c.set(n[t],t++)}if(c.has(e[l])){const r=c.get(e[l]);if(d<r&&r<s){let a=l,p=1;for(;++a<o&&a<s&&c.get(e[a])===r+p;)p++;if(p>r-d){const a=i(e[l],0);for(;d<r;)t.insertBefore(i(n[d++],1),a)}else t.replaceChild(i(n[d++],1),i(e[l++],-1))}else l++}else t.removeChild(i(e[l++],-1))}return n})(t.parentNode,e,n,u,t),w=(t,e)=>"ref"===e?(t=>e=>{"function"==typeof e?e(t):e.current=t})(t):"aria"===e?(t=>e=>{for(const n in e)t.setAttribute("role"===n?n:"aria-"+n,e[n])})(t):".dataset"===e?(({dataset:t})=>e=>{for(const n in e)t[n]=e[n]})(t):"."===e.slice(0,1)?((t,e)=>n=>{t[e]=n})(t,e.slice(1)):"on"===e.slice(0,2)?((t,e)=>{let n,i=e.slice(2);return!(e in t)&&e.toLowerCase()in t&&(i=i.toLowerCase()),e=>{const r=d(e)?e:[e,!1];n!==r[0]&&(n&&t.removeEventListener(i,n,r[1]),(n=r[0])&&t.addEventListener(i,n,r[1]))}})(t,e):((t,e)=>{let n,i=!0;const r=document.createAttributeNS(null,e);return e=>{n!==e&&(n=e,null==n?i||(t.removeAttributeNode(r),i=!0):(r.value=e,i&&(t.setAttributeNodeNS(r),i=!1)))}})(t,e);function S(t){const{type:e,path:n}=t,i=n.reduceRight(m,this);return"node"===e?(t=>{let e,n,i=[];const r=a=>{switch(typeof a){case"string":case"number":case"boolean":e!==a&&(e=a,n?n.textContent=a:n=document.createTextNode(a),i=v(t,i,[n]));break;case"object":case"undefined":if(null==a){e!=a&&(e=a,i=v(t,i,[]));break}if(d(a)){e=a,0===a.length?i=v(t,i,[]):"object"==typeof a[0]?i=v(t,i,a):r(String(a));break}"ELEMENT_NODE"in a&&e!==a&&(e=a,i=v(t,i,11===a.nodeType?p.call(a.childNodes):[a]))}};return r})(i):"attr"===e?w(i,t.name):(t=>{let e;return n=>{e!=n&&(e=n,t.textContent=null==n?"":n)}})(i)}const A=t(new WeakMap),M=(t,n)=>{const i=((t,n,i)=>{const r=[],{length:o}=t;for(let i=1;i<o;i++){const a=t[i-1];r.push(e.test(a)&&s(t,i)?a.replace(e,(t,e,r)=>`${n}${i-1}=${r||'"'}${e}${r?"":'"'}`):`${a}\x3c!--${n}${i-1}--\x3e`)}r.push(t[o-1]);const d=r.join("").trim();return i?d:d.replace(a,l)})(n,"isµ","svg"===t),r=$(i,t),o=y(r),d=[],c=n.length-1;let p=0,u="isµ"+p;for(;p<c;){const t=o.nextNode();if(!t)throw"bad template: "+i;if(8===t.nodeType)t.textContent===u&&(d.push({type:"node",path:g(t)}),u="isµ"+ ++p);else{for(;t.hasAttribute(u);)d.push({type:"attr",path:g(t),name:t.getAttribute(u)}),t.removeAttribute(u),u="isµ"+ ++p;/^(?:style|textarea)$/i.test(t.tagName)&&t.textContent.trim()===`\x3c!--${u}--\x3e`&&(d.push({type:"text",path:g(t)}),u="isµ"+ ++p)}}return{content:r,nodes:d}},z=(t,e)=>{const{content:n,nodes:i}=A.get(e)||A.set(e,M(t,e)),r=x.call(document,n,!0);return{content:r,updates:i.map(S,r)}},T=(t,{type:e,template:n,values:i})=>{const{length:r}=i;k(t,i,r);let{entry:a}=t;a&&a.template===n&&a.type===e||(t.entry=a=((t,e)=>{const{content:n,updates:i}=z(t,e);return{type:t,template:e,content:n,updates:i,wire:null}})(e,n));const{content:o,updates:s,wire:l}=a;for(let t=0;t<r;t++)s[t](i[t]);return l||(a.wire=(t=>{const{childNodes:e}=t,{length:n}=e;if(n<2)return e[0];const i=p.call(e,0);return{ELEMENT_NODE:1,nodeType:111,firstChild:i[0],lastChild:i[n-1],valueOf(){if(e.length!==n){let e=0;for(;e<n;)t.appendChild(i[e++])}return t}}})(o))},k=({stack:t},e,n)=>{for(let i=0;i<n;i++){const n=e[i];n instanceof C?e[i]=T(t[i]||(t[i]={stack:[],entry:null,wire:null}),n):d(n)?k(t[i]||(t[i]={stack:[],entry:null,wire:null}),n,n.length):t[i]=null}n<t.length&&t.splice(n)};function C(t,e,n){this.type=t,this.template=e,this.values=n}const{create:I,defineProperties:N}=Object,W=t(new WeakMap),R=e=>{const n=t(new WeakMap);return N((t,...n)=>new C(e,t,n),{for:{value(t,i){const r=n.get(t)||n.set(t,I(null));return r[i]||(r[i]=(t=>(n,...i)=>T(t,{type:e,template:n,values:i}))({stack:[],entry:null,wire:null}))}},node:{value:(t,...n)=>T({stack:[],entry:null,wire:null},{type:e,template:t,values:n}).valueOf()}})},E=R("html");R("svg");var L={uhtml:{render:(t,e)=>{const n="function"==typeof e?e():e,i=W.get(t)||W.set(t,{stack:[],entry:null,wire:null}),r=n instanceof C?T(i,n):n;return r!==i.wire&&(i.wire=r,t.textContent="",t.appendChild(r.valueOf())),t},html:E},globals:{now:Date.now,window:window,setTimeout:setTimeout,random:Math.random,DocumentFragment:()=>new DocumentFragment}};const{now:O,setTimeout:H}=L.globals,U=(t,e)=>{const n=O(),i=t();H(()=>{const t=O()<n+1e3/60?e+1:Math.max(e-1,1);U(i,t)},e)};var F=t=>{let e=t;const n=new Map;return{next:t=>{e=t(e),n.forEach(t=>t(e))},subscribe:t=>{t(e);const i={};return n.set(i,t),i},unsubscribe:t=>n.delete(t)}};const{random:B}=L.globals,j=()=>[...Array(10)].map(()=>Math.round(B())),D=F(j()),{window:P}=L.globals,_=()=>({width:P.innerWidth,height:P.innerHeight}),q=F(_());P.addEventListener("resize",()=>q.next(_));const{render:G,html:Z}=L.uhtml,{DocumentFragment:J}=L.globals,K=(t,e)=>{const n=J(),i=t=>G(n,e(Z)(t));let r=t;return{render:()=>i(r),update:t=>{r={...r,...t(r)},i(r)}}},Q=t=>Object.entries(t).reduce((t,[e,n])=>{return`${t}${i=e,i.replace(/[A-Z]/g,t=>"-"+t.toLowerCase())}:${n};`;var i},"");var V=()=>{const t={tape:j(),style:{},cellWidth:0},e=t.tape.map(t=>K({bit:t,cellWidth:0},t=>({bit:e,cellWidth:n})=>{const i=255*e,r=255-i,a=Q({display:"inline-block",width:n+"px",height:n+"px",lineHeight:n+"px",fontSize:n+"px",textAlign:"center",backgroundColor:`rgb(${i},${i},${i})`,color:`rgb(${r},${r},${r})`});return t`<div style=${a}>${e<.5?0:1}</div>`}));return K(t,t=>({tape:n,style:i,cellWidth:r})=>{const a=Q({width:10*r+"px",height:r+"px",...i});return e.forEach((t,e)=>t.update(()=>({cellWidth:r,bit:n[e]}))),t`<div style=${a}>${e.map(t=>t.render())}</div>`})};const X=V(),Y=K({position:0},t=>({position:e,cellWidth:n})=>{const i=Q({position:"absolute",top:"30%",left:"50%",transform:`translate(${n*(-.5-e)}px, 0)`});return X.update(()=>({cellWidth:n})),t`<div style=${i}>${X.render()}</div>`});q.subscribe(({width:t,height:e})=>{const n=Math.min(.15*t,.3*e);Y.update(()=>({cellWidth:n}))}),D.subscribe(t=>X.update(()=>({tape:t})));const tt=K({state:0,cellWidth:0},t=>({state:e,cellWidth:n})=>{const i=n/16,r=Q({position:"absolute",top:"30%",left:"50%",transform:`translate(-${n/2+i}px, 0)`}),a={position:"absolute",height:n+"px",background:"radial-gradient(#aaa, #666)"},o={...a,width:2*i+"px",borderRadius:`${i}px ${i}px 0 0`},s=Q({...a,top:n+"px",width:n+2*i+"px",borderRadius:`0 0 ${i}px ${i}px`,fontSize:.8*n+"px",lineHeight:n+"px",textAlign:"center",color:"white"});return t`<div style=${r}>    <div style=${Q(o)} />    <div style=${Q({...o,left:n+"px"})} />    <div style=${s}>${(t=>"E01234AH"[t+1])(e)}</div>  </div>`});q.subscribe(({width:t,height:e})=>{const n=Math.min(.15*t,.3*e);tt.update(()=>({cellWidth:n}))});const et=V(),nt=V(),it=t=>et.update(()=>({tape:t})),rt=Q({position:"absolute",top:"3%",width:"100%",fontFamily:"serif",color:"white"}),at=K({fontSize:10},t=>({fontSize:e})=>t`<div style=${rt}>  <table style=${(t=>Q({margin:"0 auto",fontSize:t+"px",lineHeight:t+"px"}))(e)}>    <tr><td>ORDER:</td><td>${et.render()}</td></tr>    <tr><td>TAPE:</td><td>${nt.render()}</td></tr>  </table></div>`);q.subscribe(({width:t,height:e})=>{const n=Math.min(.05*t,.07*e);at.update(()=>({fontSize:.6*n})),et.update(()=>({cellWidth:n})),nt.update(()=>({cellWidth:n}))}),D.subscribe(t=>nt.update(()=>({tape:t})));const ot=t=>[...t.toString()].reduceRight(([t,e],n)=>3===t.length?[n,`,${t}${e}`]:[`${n}${t}`,e],["",""]).join``,st=t=>(100*t|0).toString().padStart(4,"0").replace(/^(..)(..)/,"$1.$2"),lt=K({number:1,timeLeft:0,score:0,fontSize:0},t=>({number:e,timeLeft:n,score:i,fontSize:r})=>t`  <div style=${(t=>Q({position:"absolute",top:"1%",left:"1%",fontSize:t+"px",color:"white",fontFamily:"serif"}))(r)}>    No.${e}<span style=${(t=>Q({fontSize:.7*t+"px"}))(r)}>/${32}</span><br>    ${st(n)}  </div>  <div style=${(t=>Q({position:"absolute",bottom:"1%",left:"1%",fontSize:t+"px",color:"white",fontFamily:"serif"}))(r)}>Score: ${ot(i)}</div>`);q.subscribe(({width:t,height:e})=>{lt.update(()=>({fontSize:.6*Math.min(.05*t,.07*e)}))});const dt=[...Array(10)].map((t,e)=>({direction:1,nextChar:1&e,nextState:e>>1})),ct=F(dt),pt=(t,e)=>ct.next(n=>[...n.slice(0,t),e(n[t]),...n.slice(t+1)]),ut=F([]),ht=t=>ut.next(e=>[...e,t]),mt=()=>{let t;return ut.next(([e,...n])=>(t=e,n)),t},gt={},ft={},xt={},bt={},$t={},yt=Q({display:"inline-block",margin:"1% 1%",textAlign:"center",whiteSpace:"nowrap"}),vt=["0","1","2","3","4","A"];var wt=t=>{return K({state0:e=t>>1,char0:n=0&t,direction:1,char1:n,state1:e,disabled:!1},e=>({state0:n,char0:i,direction:r,char1:a,state1:o,disabled:s})=>e`<div style=${yt}>${`<${n},${i},`}<button onclick=${((t,e)=>()=>{pt(t,t=>({...t,direction:-e}))})(t,r)} .disabled=${s}>${(t=>t<0?"L":"R")(r)}</button>${","}<button onclick=${((t,e)=>()=>{pt(t,t=>({...t,nextChar:1-e}))})(t,a)} .disabled=${s}>${a}</button>${","}<button onclick=${((t,e)=>()=>{pt(t,t=>({...t,nextState:(e+1)%6}))})(t,o)} .disabled=${s}>${vt[o]}</button>${">"}</div>`);var e,n};const St=[...Array(10)].map((t,e)=>wt(e)),At=Q({marginBottom:"10px"}),Mt=K({fontSize:0,style:{display:"none"},disabled:!0},(({onClickRunButton:t})=>e=>({fontSize:n,style:i,disabled:r})=>(St.forEach(t=>t.update(()=>({disabled:r}))),e`<div style=${((t,e)=>Q({position:"absolute",top:"29%",left:"50%",transform:"translate(-50%, 0)",width:20*t+"px",padding:"5px 0 10px 0",textAlign:"center",fontSize:t+"px",lineHeight:t+"px",border:"1px solid #999",backgroundColor:"rgba(51, 51, 153, 0.8)",color:"white",fontFamily:"Courier New",...e}))(n,i)}>    <span style=${At}>Program</span>    <div>${St.map(t=>t.render())}</div>    <button      style=${(t=>{const e=1.3*t+"px";return Q({height:e,marginTop:"0.1em",padding:"0 1em",fontSize:e,lineHeight:e,borderRadius:.15*t+"px"})})(n)}      .disabled=${r}      onclick=${t}>RUN</button>  </div>`))({onClickRunButton:()=>{ht(bt),Mt.update(()=>({disabled:!0}))}}));q.subscribe(({width:t,height:e})=>{Mt.update(()=>({fontSize:Math.min(.04*t,.06*e)}))}),ct.subscribe(t=>{t.forEach(({direction:t,nextChar:e,nextState:n},i)=>St[i].update(()=>({state0:i>>1,char0:1&i,direction:t,char1:e,state1:n})))});const zt=Q({display:"table-cell",position:"absolute",top:"19%",width:"100%",height:"10%",textAlign:"center",verticalAlign:"middle",fontFamily:"Courier New"}),Tt=(t,e)=>Q({margin:(e-t)/2+"px 0.5em",width:5*t+"px",height:t+"px",fontSize:t+"px",borderRadius:.15*t}),kt=()=>ht(gt),Ct=()=>ht(ft),It=()=>ht(xt),Nt=K({running:!1,disabled:!0,fontSize:0,height:0},t=>({running:e,disabled:n,fontSize:i,height:r})=>t`<div style=${zt}>  <button    style=${Tt(i,r)}    onclick=${e?Ct:kt}    .disabled=${n}>${e?"HALT":"RESET"}</button>  <button    style=${Tt(i,r)}    onclick=${It}    .disabled=${n||e}>PASS</button></div>`);q.subscribe(({width:t,height:e})=>{Nt.update(()=>({fontSize:Math.min(.05*t,.065*e),height:.1*e}))});const Wt=()=>ht($t);var Rt=K({opacity:0},t=>({opacity:e})=>t`<div style=${(t=>Q({display:0===t?"none":"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.6)",opacity:t}))(e)} onclick=${Wt}></div>`);const Et={pass:{},solved:{},timeup:{}},Lt={type:Et.pass,commandsSaved:0,accepted:!1,steps:0,timeLeft:0,opacity:0,fontSize:0},Ot=new Map([[Et.pass,"#ccc"],[Et.solved,"#cfc"],[Et.timeup,"#ccf"]]),Ht=new Map([[Et.pass,"Pass"],[Et.solved,"Solved!"],[Et.timeup,"Time's up."]]),Ut=(t,e,n,i)=>100*(t+(e?1:0))*n*.1*(i/32)*3|0,Ft=K(Lt,t=>({type:e,commandsSaved:n,accepted:i,steps:r,timeLeft:a,opacity:o,fontSize:s})=>t`<div style=${(t=>Q({display:0===t?"none":"block",position:"absolute",top:"10%",width:"100%",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}))(o)}>  <div style=${((t,e)=>Q({color:Ot.get(t),fontSize:e+"px"}))(e,1.3*s)}>${Ht.get(e)}</div>  <table style=${(t=>Q({display:"inline-block",margin:t+"px 0",fontSize:t+"px",color:"white"}))(s)}>    <tr>      <td>Saved + accepted</td>      <td />      <td>Steps</td>      <td />      <td>Time left</td>    </tr>    <tr>      <td>((${n} + ${i?1:0}) &times; 100)</td>      <td>&times;</td>      <td>(${r} &times; 0.1)</td>      <td>&times;</td>      <td>(${st(a)} / ${32}.00 &times; 3)</td>    </tr>  </table>  <div style=${(t=>Q({fontSize:t+"px"}))(s)}>Score: +${ot(Ut(n,i,r,a))}</div></div>`);q.subscribe(({width:t,height:e})=>{Ft.update(()=>({fontSize:Math.min(.04*t,.06*e)}))});const Bt={finished:!1,order:Array(10).fill(0),tape:Array(10).fill(0),score:0,opacity:0,fontSize:0},jt=V(),Dt=V(),Pt={display:"inline-block"};[jt,Dt].forEach(t=>t.update(()=>({style:Pt})));const _t=K(Bt,t=>({finished:e,caseNumber:n,order:i,tape:r,score:a,opacity:o,fontSize:s})=>(jt.update(()=>({tape:i,cellWidth:s})),Dt.update(()=>({tape:r,cellWidth:s})),t`<div style=${((t,e)=>Q({display:0===t?"none":"block",position:"absolute",top:"10%",width:"100%",fontSize:e+"px",lineHeight:e+"px",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}))(o,s)}>    <div style=${((t,e)=>Q({marginBottom:e+"px",fontSize:e+"px",color:t?"#fc9":"#c99"}))(e,1.3*s)}>${e?"Finished!":"Game Over"}</div>    <div style=${"display:"+(e?"none":"block")}>${e?"":"at No."+n}</div>    ${e?"":jt.render()}<br>${e?"":Dt.render()}<br>    <div style=${(t=>Q({fontSize:t+"px",marginTop:t+"px"}))(s)}>Total score: ${ot(a)}</div>  </div>`));q.subscribe(({width:t,height:e})=>{_t.update(()=>({fontSize:Math.min(.04*t,.06*e)}))});const qt=K({opacity:0,fontSize:0},t=>({opacity:e,fontSize:n})=>t`<div style=${(t=>Q({display:0===t?"none":"block",position:"absolute",width:"100%",top:"30%",textAlign:"center",color:"white",opacity:t}))(e)}>    <div style=${(t=>Q({fontSize:t+"px",color:"orange"}))(n)}>TMP</div>  </div>`);q.subscribe(({width:t,height:e})=>{qt.update(()=>({fontSize:3*Math.min(.04*t,.6*e)}))});var Gt={title:{title:{}},main:{programWindowOpening:{},programming:{},programWindowClosing:{},running:{}},result:{caseResult:{},totalResult:{}}};const{now:Zt}=L.globals,Jt=({startedAt:t})=>{const e=Math.max(32-(Zt()-t)/1e3,0);lt.update(()=>({timeLeft:e}))},Kt=(t,e)=>{const n=e-t,i=.2*n;return 1/15<Math.abs(i)?t+i:t+Math.min(Math.max(-1/15,n),1/15)},Qt=({currentTape:t,position:e})=>{var n;n=t,D.next(t=>t.map((t,e)=>{const i=n[e];return t===i?t:Math.min(Math.max(t-1/15,i),t+1/15)})),Y.update(({position:t})=>({position:Kt(t,e)}))},Vt=(t,e)=>{const n=Math.max(50*(1-t/20),0),i=Math.min(50*(1+t/20),100),r=Math.min(87*Math.max((t-30)/10,0)+13,100),a=`polygon(${n}% 0, ${i}% 0, ${i}% ${r}%, ${n}% ${r}%)`;Mt.update(()=>({style:{clipPath:a},disabled:e}))},{now:Xt,random:Yt}=L.globals;var te=(t=0,e=0)=>({currentTape:n,position:i,machineState:r})=>{if(0===t){const t=j();return it(t),lt.update(()=>({number:1,timeLeft:32,score:0})),Rt.update(()=>({opacity:1})),{nextId:Gt.title.title,nextArgs:[1],stateUpdate:{position:0,machineState:0,order:t,currentTape:j()}}}if(Qt({currentTape:n,position:i}),tt.update(()=>({state:r})),t<30)return qt.update(()=>({opacity:t/30})),{nextId:Gt.title.title,nextArgs:[t+1]};if(30===t)return{nextId:Gt.title.title,nextArgs:[mt()===$t?31:30,(e+1)%30],stateUpdate:0===e?{currentTape:[...n.slice(0,i),Math.round(Yt()),...n.slice(i+1,10)],position:{0:1,9:8}[i]||i+(Yt()<.5?-1:1),machineState:Math.floor(5*Yt())}:{}};if(t<50){const e=(50-t)/20;return qt.update(()=>({opacity:e})),Rt.update(()=>({opacity:e})),{nextId:Gt.title.title,nextArgs:[t+1]}}qt.update(()=>({opacity:0})),Rt.update(()=>({opacity:0})),ct.next(()=>dt);const a=j();return{nextId:Gt.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:1,score:0,order:j(),originalTape:a,currentTape:a,position:0,machinState:0,executedIndices:new Map,startedAt:Xt()}}};const{now:ee}=L.globals,ne=(t,e,n)=>({type:t,time:0,accepted:e,timeLeft:n}),ie=(t,e)=>(6*t+e)/7|0,{now:re}=L.globals,ae=(t,e)=>Math.max(32-(t-e)/1e3,0);let oe=dt;ct.subscribe(t=>{oe=t});const se=({currentTape:t,position:e,machineState:n,steps:i,executedIndices:r})=>{const a=n<<1|t[e],{direction:o,nextChar:s,nextState:l}=oe[a];return{currentTape:[...t.slice(0,e),s,...t.slice(e+1)],position:e+o,machineState:l,steps:i+1,executedIndices:new Set([...r,a])}},{now:le}=L.globals,de=new Map([[Gt.title.title,te],[Gt.main.programWindowOpening,t=>e=>{it(e.order);const n=t<45;return Vt(t,n),Qt(e),Nt.update(()=>({running:!1,disabled:n})),Jt(e),n?{nextId:Gt.main.programWindowOpening,nextArgs:[t+1]}:{nextId:Gt.main.programming,nextArgs:[]}}],[Gt.main.programming,()=>t=>{Qt(t),Jt(t);const e=mt();return e===bt?(tt.update(()=>({state:0})),{nextId:Gt.main.programWindowClosing,nextArgs:[45],stateUpdate:{currentTape:t.originalTape,machineState:0,position:0,runAt:re()}}):(e===gt&&ct.next(()=>dt),e===xt?{nextId:Gt.result.caseResult,nextArgs:[ne(Et.pass,!1,ae(re(),t.startedAt))],stateUpdate:{steps:0}}:{nextId:Gt.main.programming,nextArgs:[],stateUpdate:e===gt?{currentTape:t.originalTape,machineState:0,position:0}:{}})}],[Gt.main.programWindowClosing,t=>e=>(Vt(t,!0),Qt(e),Nt.update(()=>({running:0===t,disabled:t>0})),0===t?{nextId:Gt.main.running,nextArgs:[0],stateUpdate:{steps:0,executedIndices:new Set}}:{nextId:Gt.main.programWindowClosing,nextArgs:[t-1]})],[Gt.main.running,t=>e=>{const{position:n,machineState:i,startedAt:r,runAt:a,order:o,currentTape:s}=e;if(mt()===ft)return tt.update(()=>({state:6})),ae(re(),r)>0?{nextId:Gt.main.programWindowOpening,nextArgs:[0]}:{nextId:Gt.result.totalResult,nextArgs:[!1,0]};Qt(e);const l=n<0||n>=10?-1:i;if([-1,5].includes(l)&&30===t){if(tt.update(()=>({state:l})),o.join``===s.join``){const t=ae(a,r),e=t>0?Et.solved:Et.timeup;return{nextId:Gt.result.caseResult,nextArgs:[ne(e,5===l,t)]}}return ae(re(),r)>0?{nextId:Gt.main.programWindowOpening,nextArgs:[0],stateUpdate:{machineState:l}}:{nextId:Gt.result.totalResult,nextArgs:[!1,0]}}return tt.update(()=>({state:i})),{nextId:Gt.main.running,nextArgs:[30===t?0:t+1],stateUpdate:0===t?se(e):{}}}],[Gt.result.caseResult,t=>({executedIndices:e,steps:n,caseNumber:i,score:r})=>{const{time:a,type:o,accepted:s,timeLeft:l}=t;Rt.update(()=>({opacity:Math.min(a/10,1)})),Ft.update(()=>({opacity:Math.min(Math.max(0,(a-10)/30),1)})),0===a&&Ft.update(()=>({type:o,commandsSaved:10-e.size,accepted:s,steps:n,timeLeft:l})),lt.update(({score:t})=>({score:40===a?r:ie(t,r)}));const d=mt();if(a>=40&&d===$t){if(Ft.update(()=>({opacity:0})),32===i)return{nextId:Gt.result.totalResult,nextArgs:[!0,0]};const t=i+1;lt.update(()=>({number:t}));const e=j();return Rt.update(()=>({opacity:0})),ct.next(()=>dt),tt.update(()=>({state:0})),{nextId:Gt.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:t,order:j(),originalTape:e,currentTape:e,position:0,machineState:0,executedIndices:new Map,startedAt:ee()}}}return{nextId:Gt.result.caseResult,nextArgs:[{...t,time:a+1}],stateUpdate:0===a?{score:r+Ut(10-e.size,s,n,l)}:{}}}],[Gt.result.totalResult,(t,e)=>({order:n,originalTape:i,score:r,caseNumber:a})=>{const o=mt();return e<=40?(Rt.update(()=>({opacity:Math.min(e/10,1)})),_t.update(()=>({opacity:Math.max(0,(e-10)/30),finished:t,score:r,caseNumber:a,order:n,tape:i})),{nextId:Gt.result.totalResult,nextArgs:[t,e+1]}):41===e?{nextId:Gt.result.totalResult,nextArgs:[t,o===$t?42:41]}:e<=61?(_t.update(()=>({opacity:(61-e)/20})),{nextId:Gt.result.totalResult,nextArgs:[t,e+1]}):{nextId:Gt.title.title,nextArgs:[0]}}]]),ce=(t,e)=>()=>{const{nextId:n,nextArgs:i,stateUpdate:r}=t(e);return ce(de.get(n)(...i),{...e,...r})},{render:pe,html:ue}=L.uhtml;var he,me;pe(document.getElementById("root"),ue`${[lt,at,Y,tt,Nt,Mt,Rt,Ft,_t,qt].map(t=>t.render())}`),U(ce(te(0),(he=j(),me=j(),{score:0,caseNumber:1,order:he,originalTape:me,currentTape:me,position:0,machineState:0,startedAt:le(),runAt:null,steps:0,executedIndices:new Set})),1e3/60)}();
