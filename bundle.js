(function(){"use strict";var re=(t,e,n,s,i)=>{const r=n.length;let a=e.length,o=r,c=0,p=0,l=null;for(;c<a||p<o;)if(a===c){const h=o<r?p?s(n[p-1],-0).nextSibling:s(n[o-p],0):i;for(;p<o;)t.insertBefore(s(n[p++],1),h)}else if(o===p)for(;c<a;)(!l||!l.has(e[c]))&&t.removeChild(s(e[c],-1)),c++;else if(e[c]===n[p])c++,p++;else if(e[a-1]===n[o-1])a--,o--;else if(e[c]===n[o-1]&&n[p]===e[a-1]){const h=s(e[--a],-1).nextSibling;t.insertBefore(s(n[p++],1),s(e[c++],-1).nextSibling),t.insertBefore(s(n[--o],1),h),e[a]=n[o]}else{if(!l){l=new Map;let h=p;for(;h<o;)l.set(n[h],h++)}if(l.has(e[c])){const h=l.get(e[c]);if(p<h&&h<o){let $=c,f=1;for(;++$<a&&$<o&&l.get(e[$])===h+f;)f++;if(f>h-p){const C=s(e[c],0);for(;p<h;)t.insertBefore(s(n[p++],1),C)}else t.replaceChild(s(n[p++],1),s(e[c++],-1))}else c++}else t.removeChild(s(e[c++],-1))}return n};const{isArray:At}=Array,{getPrototypeOf:oe,getOwnPropertyDescriptor:ae}=Object,ce="http://www.w3.org/2000/svg",v=[],Tt=()=>document.createRange(),tt=(t,e,n)=>(t.set(e,n),n),le=(t,e)=>{let n;do n=ae(t,e);while(!n&&(t=oe(t)));return n},de=(t,e)=>e.reduceRight(pe,t),pe=(t,e)=>t.childNodes[e],ue=1,he=8,$e=11;/*! (c) Andrea Giammarchi - ISC */const{setPrototypeOf:me}=Object;var ge=t=>{function e(n){return me(n,new.target.prototype)}return e.prototype=t.prototype,e};let T;var Mt=(t,e,n)=>(T||(T=Tt()),n?T.setStartAfter(t):T.setStartBefore(t),T.setEndAfter(e),T.deleteContents(),t);const et=({firstChild:t,lastChild:e},n)=>Mt(t,e,n);let Et=!1;const nt=(t,e)=>Et&&t.nodeType===$e?1/e<0?e?et(t,!0):t.lastChild:e?t.valueOf():t.firstChild:t,Ct=t=>document.createComment(t);class fe extends ge(DocumentFragment){#e=Ct("<>");#n=Ct("</>");#t=v;constructor(e){super(e),this.replaceChildren(this.#e,...e.childNodes,this.#n),Et=!0}get firstChild(){return this.#e}get lastChild(){return this.#n}get parentNode(){return this.#e.parentNode}remove(){et(this,!1)}replaceWith(e){et(this,!0).replaceWith(e)}valueOf(){const{parentNode:e}=this;if(e===this)this.#t===v&&(this.#t=[...this.childNodes]);else{if(e){let{firstChild:n,lastChild:s}=this;for(this.#t=[n];n!==s;)this.#t.push(n=n.nextSibling)}this.replaceChildren(...this.#t)}return this}}const Nt=(t,e,n)=>t.setAttribute(e,n),H=(t,e)=>t.removeAttribute(e),be=(t,e)=>{for(const n in e){const s=e[n],i=n==="role"?n:`aria-${n}`;s==null?H(t,i):Nt(t,i,s)}return e};let B;const xe=(t,e,n)=>{n=n.slice(1),B||(B=new WeakMap);const s=B.get(t)||tt(B,t,{});let i=s[n];return i&&i[0]&&t.removeEventListener(n,...i),i=At(e)?e:[e,!1],s[n]=i,i[0]&&t.addEventListener(n,...i),e},N=(t,e)=>{const{t:n,n:s}=t;let i=!1;switch(typeof e){case"object":if(e!==null){(s||n).replaceWith(t.n=e.valueOf());break}case"undefined":i=!0;default:n.data=i?"":e,s&&(t.n=null,s.replaceWith(n));break}return e},ye=(t,e)=>st(t,e,e==null?"class":"className"),we=(t,e)=>{const{dataset:n}=t;for(const s in e)e[s]==null?delete n[s]:n[s]=e[s];return e},j=(t,e,n)=>t[n]=e,ve=(t,e,n)=>j(t,e,n.slice(1)),st=(t,e,n)=>e==null?(H(t,n),e):j(t,e,n),It=(t,e)=>(typeof e=="function"?e(t):e.current=t,e),it=(t,e,n)=>(e==null?H(t,n):Nt(t,n,e),e),Se=(t,e)=>e==null?st(t,e,"style"):j(t.style,e,"cssText"),Ae=(t,e,n)=>(t.toggleAttribute(n.slice(1),e),e),V=(t,e,n)=>{const{length:s}=e;if(t.data=`[${s}]`,s)return re(t.parentNode,n,e,nt,t);switch(n.length){case 1:n[0].remove();case 0:break;default:Mt(nt(n[0],0),nt(n.at(-1),-0),!1);break}return v},Te=new Map([["aria",be],["class",ye],["data",we],["ref",It],["style",Se]]),Me=(t,e,n)=>{switch(e[0]){case".":return ve;case"?":return Ae;case"@":return xe;default:return n||"ownerSVGElement"in t?e==="ref"?It:it:Te.get(e)||(e in t?e.startsWith("on")?j:le(t,e)?.set?st:it:it)}},Ee=(t,e)=>(t.textContent=e??"",e),I=(t,e,n)=>({a:t,b:e,c:n}),Ce=(t,e)=>({b:t,c:e}),Ne=(t,e,n,s)=>({v,u:t,t:e,n,c:s}),k=()=>I(null,null,v);var kt=t=>(e,n)=>{const{a:s,b:i,c:r}=t(e,n),a=document.importNode(s,!0);let o=v;if(i!==v){o=[];for(let c,p,l=0;l<i.length;l++){const{a:h,b:$,c:f}=i[l],C=h===p?c:c=de(a,p=h);o[l]=Ne($,C,f,$===V?[]:$===N?k():null)}}return Ce(r?a.firstChild:new fe(a),o)};const Ie=/^(?:plaintext|script|style|textarea|title|xmp)$/i,ke=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i;/*! (c) Andrea Giammarchi - ISC */const Oe=/<([a-zA-Z0-9]+[a-zA-Z0-9:._-]*)([^>]*?)(\/?)>/g,Re=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,We=/[\x01\x02]/g;var Le=(t,e,n)=>{let s=0;return t.join("").trim().replace(Oe,(i,r,a,o)=>`<${r}${a.replace(Re,"=$2$1").trimEnd()}${o?n||ke.test(r)?" /":`></${r}`:""}>`).replace(We,i=>i===""?`<!--${e+s++}-->`:e+s++)};let G=document.createElement("template"),rt,ot;var _e=(t,e)=>{if(e)return rt||(rt=document.createElementNS(ce,"svg"),ot=Tt(),ot.selectNodeContents(rt)),ot.createContextualFragment(t);G.innerHTML=t;const{content:n}=G;return G=G.cloneNode(!1),n};const at=t=>{const e=[];let n;for(;n=t.parentNode;)e.push(e.indexOf.call(n.childNodes,t)),t=n;return e},Ot=()=>document.createTextNode(""),ze=(t,e,n)=>{const s=_e(Le(t,O,n),n),{length:i}=t;let r=v;if(i>1){const c=[],p=document.createTreeWalker(s,129);let l=0,h=`${O}${l++}`;for(r=[];l<i;){const $=p.nextNode();if($.nodeType===he){if($.data===h){const f=At(e[l-1])?V:N;f===N&&c.push($),r.push(I(at($),f,null)),h=`${O}${l++}`}}else{let f;for(;$.hasAttribute(h);){f||(f=at($));const C=$.getAttribute(h);r.push(I(f,Me($,C,n),C)),H($,h),h=`${O}${l++}`}!n&&Ie.test($.localName)&&$.textContent.trim()===`<!--${h}-->`&&(r.push(I(f||at($),Ee,null)),h=`${O}${l++}`)}}for(l=0;l<c.length;l++)c[l].replaceWith(Ot())}const{childNodes:a}=s;let{length:o}=a;return o<1?(o=1,s.appendChild(Ot())):o===1&&i!==1&&a[0].nodeType!==ue&&(o=0),tt(Rt,t,I(s,r,o===1))},Rt=new WeakMap,O="is\xB5";var Wt=t=>(e,n)=>Rt.get(e)||ze(e,n,t);const Pe=kt(Wt(!1)),De=kt(Wt(!0)),ct=(t,{s:e,t:n,v:s})=>{if(t.a!==n){const{b:i,c:r}=(e?De:Pe)(n,s);t.a=n,t.b=i,t.c=r}for(let{c:i}=t,r=0;r<i.length;r++){const a=s[r],o=i[r];switch(o.u){case V:o.v=V(o.t,Ue(o.c,a),o.v);break;case N:const c=a instanceof lt?ct(o.c||(o.c=k()),a):(o.c=null,a);c!==o.v&&(o.v=N(o,c));break;default:a!==o.v&&(o.v=o.u(o.t,a,o.n,o.v));break}}return t.b},Ue=(t,e)=>{let n=0,{length:s}=e;for(s<t.length&&t.splice(s);n<s;n++){const i=e[n];i instanceof lt?e[n]=ct(t[n]||(t[n]=k()),i):t[n]=null}return e};class lt{constructor(e,n,s){this.s=e,this.t=n,this.v=s}toDOM(e=k()){return ct(e,this)}}const Lt=new WeakMap;var Fe=(t,e)=>{const n=Lt.get(t)||tt(Lt,t,k()),{b:s}=n;return s!==(typeof e=="function"?e():e).toDOM(n)&&t.replaceChildren(n.b.valueOf()),t};/*! (c) Andrea Giammarchi - MIT */const He=(t=>(e,...n)=>new lt(t,e,n))(!1);var b={uhtml:{render:Fe,html:He},globals:{now:Date.now,window,setTimeout,random:Math.random,DocumentFragment}};const{now:_t,setTimeout:Be}=b.globals,zt=1e3/60,Pt=(t,e)=>{const n=_t(),s=t();Be(()=>{const i=_t()<n+zt?e+1:Math.max(e-1,1);Pt(s,i)},e)},Dt=32,R=32,je=.2,dt=.06666666666666667,Ut=1/15,Ft=45,pt=30;var ut=t=>{let e=t;const n=new Map;return{next:s=>{e=s(e),n.forEach(i=>i(e))},subscribe:s=>{s(e);const i={};return n.set(i,s),i},unsubscribe:s=>n.delete(s)}};const{random:Ve}=b.globals,x=()=>[...Array(10)].map(()=>Math.round(Ve())),ht=ut(x()),Ge=t=>{ht.next(e=>e.map((n,s)=>{const i=t[s];return n===i?n:Math.min(Math.max(n-Ut,i),n+Ut)}))},{render:qe,html:Xe}=b.uhtml,{DocumentFragment:Ze}=b.globals,m=(t,e)=>{const n=new Ze,s=r=>qe(n,e(Xe)(r));let i=t;return{render:()=>s(i),update:r=>{i={...i,...r(i)},s(i)}}},Je=t=>t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),u=t=>Object.entries(t).reduce((e,[n,s])=>`${e}${Je(n)}:${s};`,""),Ke=(t,e)=>m({bit:t},n=>({bit:s})=>{const i=255*s,r=255-i,a=u({display:"inline-block",width:e,height:e,lineHeight:e,fontSize:e,textAlign:"center",backgroundColor:`rgb(${i},${i},${i})`,color:`rgb(${r},${r},${r})`});return n`<div style=${a}>${s<.5?0:1}</div>`});var W=(t,e)=>{const n={tape:x(),style:{}},s=`min(${t}vw, ${e}vh)`,i=n.tape.map(r=>Ke(r,s));return m(n,r=>({tape:a,style:o})=>{const c=u({width:`calc(${s} * 10)`,height:s,...o});return i.forEach((p,l)=>p.update(()=>({bit:a[l]}))),r`<div style=${c}>${i.map(p=>p.render())}</div>`})};const Ht=W(15,30),Bt=m({position:0},t=>({position:e})=>{const n=u({position:"absolute",top:"30%",left:"50%",transform:`translateX(calc(-5% - ${e} * 10%))`});return t`<div style=${n}>${Ht.render()}</div>`});ht.subscribe(t=>Ht.update(()=>({tape:t})));const Qe={state:0},Ye=t=>"E01234AH"[t+1],w="min(15vw, 30vh)",q=`calc(${w} / 16)`,tn=u({position:"absolute",top:"30%",left:`calc(50% - ${w} * 9 / 16)`}),jt={position:"absolute",height:w,background:"radial-gradient(#aaa, #666)"},Vt={...jt,width:`calc(${w} / 8)`,borderRadius:`${q} ${q} 0 0`},en=u(Vt),nn=u({...Vt,left:w}),sn=u({...jt,top:w,width:`calc(${w} * 9 / 8)`,borderRadius:`0 0 ${q} ${q}`,fontSize:`calc(${w} * 0.8)`,lineHeight:w,textAlign:"center",color:"white"}),S=m(Qe,t=>({state:e})=>t`<div style=${tn}><div style=${en} /><div style=${nn} /><div style=${sn}>${Ye(e)}</div></div>`),Gt=W(5,7),qt=W(5,7),Xt=t=>Gt.update(()=>({tape:t})),rn=u({position:"absolute",top:"3%",width:"100%",fontFamily:"serif",color:"white"}),on=u({margin:"0 auto",fontSize:"min(3vw, 4.2vh)",lineHeight:"min(3vw, 4.2vh)"}),an=m({},t=>()=>t`<div style=${rn}><table style=${on}><tr><td>ORDER:</td><td>${Gt.render()}</td></tr><tr><td>TAPE:</td><td>${qt.render()}</td></tr></table></div>`);ht.subscribe(t=>qt.update(()=>({tape:t})));const cn={number:1,timeLeft:0,score:0},$t="min(3vw, 4.2vh)",ln=u({position:"absolute",top:"1%",left:"1%",fontSize:$t,color:"white",fontFamily:"serif"}),dn=u({fontSize:`calc(${$t} * 0.7)`}),pn=u({position:"absolute",bottom:"1%",left:"1%",fontSize:$t,color:"white",fontFamily:"serif"}),mt=t=>[...t.toString()].reduceRight(([e,n],s)=>e.length===3?[s,`,${e}${n}`]:[`${s}${e}`,n],["",""]).join``,Zt=t=>(t*100|0).toString().padStart(4,"0").replace(/^(..)(..)/,"$1.$2"),L=m(cn,t=>({number:e,timeLeft:n,score:s})=>t`<div style=${ln}>No.${e}<span style=${dn}>/${Dt}</span><br>${Zt(n)}</div><div style=${pn}>Score: ${mt(s)}</div>`),_=[...Array(10)].map((t,e)=>({direction:1,nextChar:e&1,nextState:e>>1})),M=ut(_),gt=(t,e)=>M.next(n=>[...n.slice(0,t),e(n[t]),...n.slice(t+1)]),Jt=ut([]),z=t=>Jt.next(e=>[...e,t]),P=()=>{let t;return Jt.next(([e,...n])=>(t=e,n)),t},g={reset:{},halt:{},pass:{},run:{},goNext:{}},un=(t,e)=>({state0:t,char0:e,direction:1,char1:e,state1:t,disabled:!1}),hn=u({display:"inline-block",margin:"1% 1%",textAlign:"center",whiteSpace:"nowrap"}),$n=t=>t<0?"L":"R",mn=["0","1","2","3","4","A"],gn=(t,e)=>()=>{gt(t,n=>({...n,direction:-e}))},fn=(t,e)=>()=>{gt(t,n=>({...n,nextChar:1-e}))},bn=(t,e)=>()=>{gt(t,n=>({...n,nextState:(e+1)%6}))};var xn=t=>m(un(t>>1,t&0),e=>({state0:n,char0:s,direction:i,char1:r,state1:a,disabled:o})=>e`<div style=${hn}>${`<${n},${s},`}<button onclick=${gn(t,i)} .disabled=${o}>${$n(i)}</button>${","}<button onclick=${fn(t,r)} .disabled=${o}>${r}</button>${","}<button onclick=${bn(t,a)} .disabled=${o}>${mn[a]}</button>${">"}</div>`);const yn={style:{display:"none"},disabled:!0},ft=[...Array(10)].map((t,e)=>xn(e)),D="min(4vw, 6vh)",wn=t=>u({position:"absolute",top:"29%",left:"50%",transform:"translate(-50%, 0)",width:`calc(${D} * 20)`,padding:"5px 0 10px 0",textAlign:"center",fontSize:D,lineHeight:D,border:"1px solid #999",backgroundColor:"rgba(51, 51, 153, 0.8)",color:"white",fontFamily:"Courier New",...t}),vn=u({marginBottom:"10px"}),bt=`calc(${D} * 1.3)`,Sn=u({height:bt,marginTop:"0.1em",padding:"0 1em",fontSize:bt,lineHeight:bt,borderRadius:`calc(${D} * 0.15)`}),X=m(yn,(({onClickRunButton:t})=>e=>({style:n,disabled:s})=>(ft.forEach(i=>i.update(()=>({disabled:s}))),e`<div style=${wn(n)}><span style=${vn}>Program</span><div>${ft.map(i=>i.render())}</div><button style=${Sn} .disabled=${s} onclick=${t}>RUN</button></div>`))({onClickRunButton:()=>{z(g.run),X.update(()=>({disabled:!0}))}}));M.subscribe(t=>{t.forEach(({direction:e,nextChar:n,nextState:s},i)=>ft[i].update(()=>({state0:i>>1,char0:i&1,direction:e,char1:n,state1:s})))});const An={running:!1,disabled:!0},Tn=u({display:"table-cell",position:"absolute",top:"19%",width:"100%",height:"10%",textAlign:"center",verticalAlign:"middle",fontFamily:"Courier New"}),U="min(5vw, 6.5vh)",Kt=u({margin:`calc(5vh - ${U} / 2) 0.5em`,width:`calc(${U} * 5)`,height:U,fontSize:U,borderRadius:`calc(${U} * 0.15)`}),Mn=()=>z(g.reset),En=()=>z(g.halt),Cn=()=>z(g.pass),xt=m(An,t=>({running:e,disabled:n})=>t`<div style=${Tn}><button style=${Kt} onclick=${e?En:Mn} .disabled=${n}>${e?"HALT":"RESET"}</button><button style=${Kt} onclick=${Cn} .disabled=${n||e}>PASS</button></div>`),Nn=t=>u({display:t===0?"none":"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.6)",opacity:t}),In=()=>z(g.goNext);var A=m({opacity:0},t=>({opacity:e})=>t`<div style=${Nn(e)} onclick=${In}></div>`);const y={pass:{},solved:{},timeup:{}},kn={type:y.pass,commandsSaved:0,accepted:!1,steps:0,timeLeft:0,opacity:0},On=t=>u({display:t===0?"none":"block",position:"absolute",top:"10%",width:"100%",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}),Rn=new Map([[y.pass,"#ccc"],[y.solved,"#cfc"],[y.timeup,"#ccf"]]),Z="min(4vw, 6vh)",Wn=t=>u({color:Rn.get(t),fontSize:`calc(${Z} * 1.3)`}),Ln=new Map([[y.pass,"Pass"],[y.solved,"Solved!"],[y.timeup,"Time's up."]]),_n=u({display:"inline-block",margin:`${Z} 0`,fontSize:Z,color:"white"}),zn=u({fontSize:Z}),Qt=(t,e,n,s)=>(t+(e?1:0))*100*n*.1*(s/R)*3|0,J=m(kn,t=>({type:e,commandsSaved:n,accepted:s,steps:i,timeLeft:r,opacity:a})=>t`<div style=${On(a)}><div style=${Wn(e)}>${Ln.get(e)}</div><table style=${_n}><tr><td>Saved + accepted</td><td /><td>Steps</td><td /><td>Time left</td></tr><tr><td>((${n} + ${s?1:0}) &times; 100)</td><td>&times;</td><td>(${i} &times; 0.1)</td><td>&times;</td><td>(${Zt(r)} / ${R}.00 &times; 3)</td></tr></table><div style=${zn}>Score: +${mt(Qt(n,s,i,r))}</div></div>`),Pn={finished:!1,order:Array(10).fill(0),tape:Array(10).fill(0),score:0,opacity:0},E="min(4vw, 6vh)",Dn=t=>u({display:t===0?"none":"block",position:"absolute",top:"10%",width:"100%",fontSize:E,lineHeight:E,textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}),Un=t=>u({marginBottom:E,fontSize:`calc(${E} * 1.3)`,color:t?"#fc9":"#c99"}),yt=W(4,6),wt=W(4,6),Fn={display:"inline-block"};[yt,wt].forEach(t=>t.update(()=>({style:Fn})));const Hn=u({fontSize:E,marginTop:E}),vt=m(Pn,t=>({finished:e,caseNumber:n,order:s,tape:i,score:r,opacity:a})=>{yt.update(()=>({tape:s})),wt.update(()=>({tape:i}));const o=`display:${e?"none":"block"}`,c=e?"":`at No.${n}`;return t`<div style=${Dn(a)}><div style=${Un(e)}>${e?"Finished!":"Game Over"}</div><div style=${o}>${c}</div>${e?"":yt.render()}<br>${e?"":wt.render()}<br><div style=${Hn}>Total score: ${mt(r)}</div></div>`}),Bn={opacity:0},jn=t=>u({display:t===0?"none":"block",position:"absolute",width:"100%",top:"30%",textAlign:"center",color:"white",opacity:t}),Vn=u({fontSize:"min(12vw, 18vh)",color:"orange"}),K=m(Bn,t=>({opacity:e})=>t`<div style=${jn(e)}><div style=${Vn}>TMP</div></div>`);var d={title:{title:{}},main:{programWindowOpening:{},programming:{},programWindowClosing:{},running:{}},result:{caseResult:{},totalResult:{}}};const{now:Gn}=b.globals,Yt=({startedAt:t})=>{const e=Math.max(R-(Gn()-t)/1e3,0);L.update(()=>({timeLeft:e}))},qn=(t,e)=>{const n=e-t,s=n*je;return dt<Math.abs(s)?t+s:t+Math.min(Math.max(-dt,n),dt)},F=({currentTape:t,position:e})=>{Ge(t),Bt.update(({position:n})=>({position:qn(n,e)}))},te=(t,e)=>{const n=Math.max((1-t/20)*50,0),s=Math.min((1+t/20)*50,100),i=Math.min(Math.max((t-30)/10,0)*87+13,100);X.update(()=>({style:{clipPath:`polygon(${n}% 0, ${s}% 0, ${s}% ${i}%, ${n}% ${i}%)`},disabled:e}))},{now:Xn,random:St}=b.globals;var ee=(t=0,e=0)=>({currentTape:n,position:s,machineState:i})=>{if(t===0){const a=x();return Xt(a),L.update(()=>({number:1,timeLeft:R,score:0})),A.update(()=>({opacity:1})),{nextId:d.title.title,nextArgs:[1],stateUpdate:{position:0,machineState:0,order:a,currentTape:x()}}}if(F({currentTape:n,position:s}),S.update(()=>({state:i})),t<30)return K.update(()=>({opacity:t/30})),{nextId:d.title.title,nextArgs:[t+1]};if(t===30)return{nextId:d.title.title,nextArgs:[P()===g.goNext?31:30,(e+1)%pt],stateUpdate:e===0?{currentTape:[...n.slice(0,s),Math.round(St()),...n.slice(s+1,10)],position:{0:1,9:8}[s]||s+(St()<.5?-1:1),machineState:Math.floor(St()*5)}:{}};if(t<50){const a=(50-t)/20;return K.update(()=>({opacity:a})),A.update(()=>({opacity:a})),{nextId:d.title.title,nextArgs:[t+1]}}K.update(()=>({opacity:0})),A.update(()=>({opacity:0})),M.next(()=>_);const r=x();return{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:1,score:0,order:x(),originalTape:r,currentTape:r,position:0,machinState:0,executedIndices:new Map,startedAt:Xn()}}};const{now:Zn}=b.globals,ne=(t,e,n)=>({type:t,time:0,accepted:e,timeLeft:n}),Jn=(t,e)=>(t*6+e)/7|0,Kn=t=>({executedIndices:e,steps:n,caseNumber:s,score:i})=>{const{time:r,type:a,accepted:o,timeLeft:c}=t;A.update(()=>({opacity:Math.min(r/10,1)})),J.update(()=>({opacity:Math.min(Math.max(0,(r-10)/30),1)})),r===0&&(J.update(()=>({type:a,commandsSaved:10-e.size,accepted:o,steps:n,timeLeft:c})),X.update(()=>({disabled:!0}))),L.update(({score:l})=>({score:r===40?i:Jn(l,i)}));const p=P();if(r>=40&&p===g.goNext){if(J.update(()=>({opacity:0})),s===Dt)return{nextId:d.result.totalResult,nextArgs:[!0,0]};const l=s+1;L.update(()=>({number:l}));const h=x();return A.update(()=>({opacity:0})),M.next(()=>_),S.update(()=>({state:0})),{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:l,order:x(),originalTape:h,currentTape:h,position:0,machineState:0,executedIndices:new Map,startedAt:Zn()}}}return{nextId:d.result.caseResult,nextArgs:[{...t,time:r+1}],stateUpdate:r===0?{score:i+Qt(10-e.size,o,n,c)}:{}}},Qn=(t,e)=>({order:n,originalTape:s,score:i,caseNumber:r})=>{const a=P();return e<=40?(A.update(()=>({opacity:Math.min(e/10,1)})),vt.update(()=>({opacity:Math.max(0,(e-10)/30),finished:t,score:i,caseNumber:r,order:n,tape:s})),{nextId:d.result.totalResult,nextArgs:[t,e+1]}):e===41?{nextId:d.result.totalResult,nextArgs:[t,a===g.goNext?42:41]}:e<=61?(vt.update(()=>({opacity:(61-e)/20})),{nextId:d.result.totalResult,nextArgs:[t,e+1]}):{nextId:d.title.title,nextArgs:[0]}},{now:Q}=b.globals,Y=(t,e)=>Math.max(R-(t-e)/1e3,0),Yn=t=>e=>{Xt(e.order);const n=t<Ft;return te(t,n),F(e),xt.update(()=>({running:!1,disabled:n})),Yt(e),n?{nextId:d.main.programWindowOpening,nextArgs:[t+1]}:{nextId:d.main.programming,nextArgs:[]}},ts=()=>t=>{F(t),Yt(t);const e=P();return e===g.run?(S.update(()=>({state:0})),{nextId:d.main.programWindowClosing,nextArgs:[Ft],stateUpdate:{currentTape:t.originalTape,machineState:0,position:0,runAt:Q()}}):(e===g.reset&&M.next(()=>_),e===g.pass?{nextId:d.result.caseResult,nextArgs:[ne(y.pass,!1,Y(Q(),t.startedAt))],stateUpdate:{steps:0}}:{nextId:d.main.programming,nextArgs:[],stateUpdate:e===g.reset?{currentTape:t.originalTape,machineState:0,position:0}:{}})},es=t=>e=>(te(t,!0),F(e),xt.update(()=>({running:t===0,disabled:t>0})),t===0?{nextId:d.main.running,nextArgs:[0],stateUpdate:{steps:0,executedIndices:new Set}}:{nextId:d.main.programWindowClosing,nextArgs:[t-1]});let se=_;M.subscribe(t=>{se=t});const ns=({currentTape:t,position:e,machineState:n,steps:s,executedIndices:i})=>{const r=n<<1|t[e],{direction:a,nextChar:o,nextState:c}=se[r];return{currentTape:[...t.slice(0,e),o,...t.slice(e+1)],position:e+a,machineState:c,steps:s+1,executedIndices:new Set([...i,r])}},ss=t=>e=>{const{position:n,machineState:s,startedAt:i,runAt:r,order:a,currentTape:o}=e;if(P()===g.halt)return S.update(()=>({state:6})),Y(Q(),i)>0?{nextId:d.main.programWindowOpening,nextArgs:[0]}:{nextId:d.result.totalResult,nextArgs:[!1,0]};F(e);const c=n<0||n>=10?-1:s;if([-1,5].includes(c)&&t===pt){if(S.update(()=>({state:c})),a.join``===o.join``){const p=Y(r,i),l=p>0?y.solved:y.timeup;return{nextId:d.result.caseResult,nextArgs:[ne(l,c===5,p)]}}return Y(Q(),i)>0?{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{machineState:c}}:{nextId:d.result.totalResult,nextArgs:[!1,0]}}return S.update(()=>({state:s})),{nextId:d.main.running,nextArgs:[t===pt?0:t+1],stateUpdate:t===0?ns(e):{}}},{now:is}=b.globals,rs=new Map([[d.title.title,ee],[d.main.programWindowOpening,Yn],[d.main.programming,ts],[d.main.programWindowClosing,es],[d.main.running,ss],[d.result.caseResult,Kn],[d.result.totalResult,Qn]]),os=(t,e)=>({score:0,caseNumber:1,order:t,originalTape:e,currentTape:e,position:0,machineState:0,startedAt:is(),runAt:null,steps:0,executedIndices:new Set}),ie=(t,e)=>()=>{const{nextId:n,nextArgs:s,stateUpdate:i}=t(e);return ie(rs.get(n)(...s),{...e,...i})},{render:as,html:cs}=b.uhtml;as(document.getElementById("root"),cs`${[L,an,Bt,S,xt,X,A,J,vt,K].map(t=>t.render())}`),Pt(ie(ee(0),os(x(),x())),zt)})();
