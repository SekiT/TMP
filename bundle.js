!function(){"use strict";var t=t=>({get:e=>t.get(e),set:(e,n)=>(t.set(e,n),n)});const e=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,n=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,i=/<[a-z][^>]+$/i,r=/>[^<>]*$/,a=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/gi,o=/\s+$/,s=(t,e)=>0<e--&&(i.test(t[e])||!r.test(t[e])&&s(t,e)),l=(t,e,i)=>n.test(e)?t:`<${e}${i.replace(o,"")}></${e}>`;const{isArray:d}=Array,{indexOf:c,slice:p}=[],u=(t,e)=>111===t.nodeType?1/e<0?e?(({firstChild:t,lastChild:e})=>{const n=document.createRange();return n.setStartAfter(t),n.setEndAfter(e),n.deleteContents(),t})(t):t.lastChild:e?t.valueOf():t.firstChild:t;
/*! (c) Andrea Giammarchi - ISC */
var h=function(t){var e="fragment",n="template",i="content"in a(n)?function(t){var e=a(n);return e.innerHTML=t,e.content}:function(t){var i=a(e),o=a(n),s=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(t)){var l=RegExp.$1;o.innerHTML="<table>"+t+"</table>",s=o.querySelectorAll(l)}else o.innerHTML=t,s=o.childNodes;return r(i,s),i};return function(t,e){return("svg"===e?o:i)(t)};function r(t,e){for(var n=e.length;n--;)t.appendChild(e[0])}function a(n){return n===e?t.createDocumentFragment():t.createElementNS("http://www.w3.org/1999/xhtml",n)}function o(t){var n=a(e),i=a("div");return i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t+"</svg>",r(n,i.firstChild.childNodes),n}}(document);const m=({childNodes:t},e)=>t[e],g=t=>{const e=[];let{parentNode:n}=t;for(;n;)e.push(c.call(n.childNodes,t)),n=(t=n).parentNode;return e},{createTreeWalker:x,importNode:f}=document,b=1!=f.length,$=b?(t,e)=>f.call(document,h(t,e),!0):h,y=b?t=>x.call(document,t,129,null,!1):t=>x.call(document,t,129),v=(t,e,n)=>((t,e,n,i,r)=>{const a=n.length;let o=e.length,s=a,l=0,d=0,c=null;for(;l<o||d<s;)if(o===l){const e=s<a?d?i(n[d-1],-0).nextSibling:i(n[s-d],0):r;for(;d<s;)t.insertBefore(i(n[d++],1),e)}else if(s===d)for(;l<o;)c&&c.has(e[l])||t.removeChild(i(e[l],-1)),l++;else if(e[l]===n[d])l++,d++;else if(e[o-1]===n[s-1])o--,s--;else if(e[l]===n[s-1]&&n[d]===e[o-1]){const r=i(e[--o],-1).nextSibling;t.insertBefore(i(n[d++],1),i(e[l++],-1).nextSibling),t.insertBefore(i(n[--s],1),r),e[o]=n[s]}else{if(!c){c=new Map;let t=d;for(;t<s;)c.set(n[t],t++)}if(c.has(e[l])){const r=c.get(e[l]);if(d<r&&r<s){let a=l,p=1;for(;++a<o&&a<s&&c.get(e[a])===r+p;)p++;if(p>r-d){const a=i(e[l],0);for(;d<r;)t.insertBefore(i(n[d++],1),a)}else t.replaceChild(i(n[d++],1),i(e[l++],-1))}else l++}else t.removeChild(i(e[l++],-1))}return n})(t.parentNode,e,n,u,t),w=(t,e)=>"ref"===e?(t=>e=>{"function"==typeof e?e(t):e.current=t})(t):"aria"===e?(t=>e=>{for(const n in e){const i="role"===n?n:"aria-"+n,r=e[n];null==r?t.removeAttribute(i):t.setAttribute(i,r)}})(t):".dataset"===e?(({dataset:t})=>e=>{for(const n in e){const i=e[n];null==i?delete t[n]:t[n]=i}})(t):"."===e.slice(0,1)?((t,e)=>n=>{t[e]=n})(t,e.slice(1)):"on"===e.slice(0,2)?((t,e)=>{let n,i=e.slice(2);return!(e in t)&&e.toLowerCase()in t&&(i=i.toLowerCase()),e=>{const r=d(e)?e:[e,!1];n!==r[0]&&(n&&t.removeEventListener(i,n,r[1]),(n=r[0])&&t.addEventListener(i,n,r[1]))}})(t,e):((t,e)=>{let n,i=!0;const r=document.createAttributeNS(null,e);return e=>{n!==e&&(n=e,null==n?i||(t.removeAttributeNode(r),i=!0):(r.value=e,i&&(t.setAttributeNodeNS(r),i=!1)))}})(t,e);function S(t){const{type:e,path:n}=t,i=n.reduceRight(m,this);return"node"===e?(t=>{let e,n,i=[];const r=a=>{switch(typeof a){case"string":case"number":case"boolean":e!==a&&(e=a,n?n.textContent=a:n=document.createTextNode(a),i=v(t,i,[n]));break;case"object":case"undefined":if(null==a){e!=a&&(e=a,i=v(t,i,[]));break}if(d(a)){e=a,0===a.length?i=v(t,i,[]):"object"==typeof a[0]?i=v(t,i,a):r(String(a));break}"ELEMENT_NODE"in a&&e!==a&&(e=a,i=v(t,i,11===a.nodeType?p.call(a.childNodes):[a]))}};return r})(i):"attr"===e?w(i,t.name):(t=>{let e;return n=>{e!=n&&(e=n,t.textContent=null==n?"":n)}})(i)}const A="isµ",M=t(new WeakMap),z=(t,n)=>{const i=((t,n,i)=>{const r=[],{length:o}=t;for(let i=1;i<o;i++){const a=t[i-1];r.push(e.test(a)&&s(t,i)?a.replace(e,(t,e,r)=>`${n}${i-1}=${r||'"'}${e}${r?"":'"'}`):`${a}\x3c!--${n}${i-1}--\x3e`)}r.push(t[o-1]);const d=r.join("").trim();return i?d:d.replace(a,l)})(n,A,"svg"===t),r=$(i,t),o=y(r),d=[],c=n.length-1;let p=0,u="isµ"+p;for(;p<c;){const t=o.nextNode();if(!t)throw"bad template: "+i;if(8===t.nodeType)t.textContent===u&&(d.push({type:"node",path:g(t)}),u="isµ"+ ++p);else{for(;t.hasAttribute(u);)d.push({type:"attr",path:g(t),name:t.getAttribute(u)}),t.removeAttribute(u),u="isµ"+ ++p;/^(?:style|textarea)$/i.test(t.tagName)&&t.textContent.trim()===`\x3c!--${u}--\x3e`&&(t.textContent="",d.push({type:"text",path:g(t)}),u="isµ"+ ++p)}}return{content:r,nodes:d}},T=(t,e)=>{const{content:n,nodes:i}=M.get(e)||M.set(e,z(t,e)),r=f.call(document,n,!0);return{content:r,updates:i.map(S,r)}},k=(t,{type:e,template:n,values:i})=>{const{length:r}=i;C(t,i,r);let{entry:a}=t;a&&a.template===n&&a.type===e||(t.entry=a=((t,e)=>{const{content:n,updates:i}=T(t,e);return{type:t,template:e,content:n,updates:i,wire:null}})(e,n));const{content:o,updates:s,wire:l}=a;for(let t=0;t<r;t++)s[t](i[t]);return l||(a.wire=(t=>{const{childNodes:e}=t,{length:n}=e;if(n<2)return n?e[0]:t;const i=p.call(e,0);return{ELEMENT_NODE:1,nodeType:111,firstChild:i[0],lastChild:i[n-1],valueOf(){if(e.length!==n){let e=0;for(;e<n;)t.appendChild(i[e++])}return t}}})(o))},C=({stack:t},e,n)=>{for(let i=0;i<n;i++){const n=e[i];n instanceof I?e[i]=k(t[i]||(t[i]={stack:[],entry:null,wire:null}),n):d(n)?C(t[i]||(t[i]={stack:[],entry:null,wire:null}),n,n.length):t[i]=null}n<t.length&&t.splice(n)};function I(t,e,n){this.type=t,this.template=e,this.values=n}const{create:N,defineProperties:W}=Object,R=e=>{const n=t(new WeakMap);return W((t,...n)=>new I(e,t,n),{for:{value(t,i){const r=n.get(t)||n.set(t,N(null));return r[i]||(r[i]=(t=>(n,...i)=>k(t,{type:e,template:n,values:i}))({stack:[],entry:null,wire:null}))}},node:{value:(t,...n)=>k({stack:[],entry:null,wire:null},{type:e,template:t,values:n}).valueOf()}})},E=t(new WeakMap),L=R("html");R("svg");var O={uhtml:{render:(t,e)=>{const n="function"==typeof e?e():e,i=E.get(t)||E.set(t,{stack:[],entry:null,wire:null}),r=n instanceof I?k(i,n):n;return r!==i.wire&&(i.wire=r,t.textContent="",t.appendChild(r.valueOf())),t},html:L},globals:{now:Date.now,window:window,setTimeout:setTimeout,random:Math.random,DocumentFragment:DocumentFragment}};const{now:H,setTimeout:U}=O.globals,F=1e3/60,B=(t,e)=>{const n=H(),i=t();U(()=>{const t=H()<n+F?e+1:Math.max(e-1,1);B(i,t)},e)},j=1/15,D=1/15;var P=t=>{let e=t;const n=new Map;return{next:t=>{e=t(e),n.forEach(t=>t(e))},subscribe:t=>{t(e);const i={};return n.set(i,t),i},unsubscribe:t=>n.delete(t)}};const{random:_}=O.globals,q=()=>[...Array(10)].map(()=>Math.round(_())),G=P(q()),{window:Z}=O.globals,J=()=>({width:Z.innerWidth,height:Z.innerHeight}),K=P(J());Z.addEventListener("resize",()=>K.next(J));const{render:Q,html:V}=O.uhtml,{DocumentFragment:X}=O.globals,Y=(t,e)=>{const n=new X,i=t=>Q(n,e(V)(t));let r=t;return{render:()=>i(r),update:t=>{r={...r,...t(r)},i(r)}}},tt=t=>Object.entries(t).reduce((t,[e,n])=>{return`${t}${i=e,i.replace(/[A-Z]/g,t=>"-"+t.toLowerCase())}:${n};`;var i},"");var et=()=>{const t={tape:q(),style:{},cellWidth:0},e=t.tape.map(t=>Y({bit:t,cellWidth:0},t=>({bit:e,cellWidth:n})=>{const i=255*e,r=255-i,a=tt({display:"inline-block",width:n+"px",height:n+"px",lineHeight:n+"px",fontSize:n+"px",textAlign:"center",backgroundColor:`rgb(${i},${i},${i})`,color:`rgb(${r},${r},${r})`});return t`<div style=${a}>${e<.5?0:1}</div>`}));return Y(t,t=>({tape:n,style:i,cellWidth:r})=>{const a=tt({width:10*r+"px",height:r+"px",...i});return e.forEach((t,e)=>t.update(()=>({cellWidth:r,bit:n[e]}))),t`<div style=${a}>${e.map(t=>t.render())}</div>`})};const nt=et(),it=Y({position:0},t=>({position:e,cellWidth:n})=>{const i=tt({position:"absolute",top:"30%",left:"50%",transform:`translate(${n*(-.5-e)}px, 0)`});return nt.update(()=>({cellWidth:n})),t`<div style=${i}>${nt.render()}</div>`});K.subscribe(({width:t,height:e})=>{const n=Math.min(.15*t,.3*e);it.update(()=>({cellWidth:n}))}),G.subscribe(t=>nt.update(()=>({tape:t})));const rt=Y({state:0,cellWidth:0},t=>({state:e,cellWidth:n})=>{const i=n/16,r=tt({position:"absolute",top:"30%",left:"50%",transform:`translate(-${n/2+i}px, 0)`}),a={position:"absolute",height:n+"px",background:"radial-gradient(#aaa, #666)"},o={...a,width:2*i+"px",borderRadius:`${i}px ${i}px 0 0`},s=tt({...a,top:n+"px",width:n+2*i+"px",borderRadius:`0 0 ${i}px ${i}px`,fontSize:.8*n+"px",lineHeight:n+"px",textAlign:"center",color:"white"});return t`<div style=${r}>    <div style=${tt(o)} />    <div style=${tt({...o,left:n+"px"})} />    <div style=${s}>${(t=>"E01234AH"[t+1])(e)}</div>  </div>`});K.subscribe(({width:t,height:e})=>{const n=Math.min(.15*t,.3*e);rt.update(()=>({cellWidth:n}))});const at=et(),ot=et(),st=t=>at.update(()=>({tape:t})),lt=tt({position:"absolute",top:"3%",width:"100%",fontFamily:"serif",color:"white"}),dt=Y({fontSize:10},t=>({fontSize:e})=>t`<div style=${lt}>  <table style=${(t=>tt({margin:"0 auto",fontSize:t+"px",lineHeight:t+"px"}))(e)}>    <tr><td>ORDER:</td><td>${at.render()}</td></tr>    <tr><td>TAPE:</td><td>${ot.render()}</td></tr>  </table></div>`);K.subscribe(({width:t,height:e})=>{const n=Math.min(.05*t,.07*e);dt.update(()=>({fontSize:.6*n})),at.update(()=>({cellWidth:n})),ot.update(()=>({cellWidth:n}))}),G.subscribe(t=>ot.update(()=>({tape:t})));const ct=t=>[...t.toString()].reduceRight(([t,e],n)=>3===t.length?[n,`,${t}${e}`]:[`${n}${t}`,e],["",""]).join``,pt=t=>(100*t|0).toString().padStart(4,"0").replace(/^(..)(..)/,"$1.$2"),ut=Y({number:1,timeLeft:0,score:0,fontSize:0},t=>({number:e,timeLeft:n,score:i,fontSize:r})=>t`  <div style=${(t=>tt({position:"absolute",top:"1%",left:"1%",fontSize:t+"px",color:"white",fontFamily:"serif"}))(r)}>    No.${e}<span style=${(t=>tt({fontSize:.7*t+"px"}))(r)}>/${32}</span><br>    ${pt(n)}  </div>  <div style=${(t=>tt({position:"absolute",bottom:"1%",left:"1%",fontSize:t+"px",color:"white",fontFamily:"serif"}))(r)}>Score: ${ct(i)}</div>`);K.subscribe(({width:t,height:e})=>{ut.update(()=>({fontSize:.6*Math.min(.05*t,.07*e)}))});const ht=[...Array(10)].map((t,e)=>({direction:1,nextChar:1&e,nextState:e>>1})),mt=P(ht),gt=(t,e)=>mt.next(n=>[...n.slice(0,t),e(n[t]),...n.slice(t+1)]),xt=P([]),ft=t=>xt.next(e=>[...e,t]),bt=()=>{let t;return xt.next(([e,...n])=>(t=e,n)),t},$t={},yt={},vt={},wt={},St={},At=tt({display:"inline-block",margin:"1% 1%",textAlign:"center",whiteSpace:"nowrap"}),Mt=["0","1","2","3","4","A"];var zt=t=>{return Y({state0:e=t>>1,char0:n=0&t,direction:1,char1:n,state1:e,disabled:!1},e=>({state0:n,char0:i,direction:r,char1:a,state1:o,disabled:s})=>e`<div style=${At}>${`<${n},${i},`}<button onclick=${((t,e)=>()=>{gt(t,t=>({...t,direction:-e}))})(t,r)} .disabled=${s}>${(t=>t<0?"L":"R")(r)}</button>${","}<button onclick=${((t,e)=>()=>{gt(t,t=>({...t,nextChar:1-e}))})(t,a)} .disabled=${s}>${a}</button>${","}<button onclick=${((t,e)=>()=>{gt(t,t=>({...t,nextState:(e+1)%6}))})(t,o)} .disabled=${s}>${Mt[o]}</button>${">"}</div>`);var e,n};const Tt=[...Array(10)].map((t,e)=>zt(e)),kt=tt({marginBottom:"10px"}),Ct=Y({fontSize:0,style:{display:"none"},disabled:!0},(({onClickRunButton:t})=>e=>({fontSize:n,style:i,disabled:r})=>(Tt.forEach(t=>t.update(()=>({disabled:r}))),e`<div style=${((t,e)=>tt({position:"absolute",top:"29%",left:"50%",transform:"translate(-50%, 0)",width:20*t+"px",padding:"5px 0 10px 0",textAlign:"center",fontSize:t+"px",lineHeight:t+"px",border:"1px solid #999",backgroundColor:"rgba(51, 51, 153, 0.8)",color:"white",fontFamily:"Courier New",...e}))(n,i)}>    <span style=${kt}>Program</span>    <div>${Tt.map(t=>t.render())}</div>    <button      style=${(t=>{const e=1.3*t+"px";return tt({height:e,marginTop:"0.1em",padding:"0 1em",fontSize:e,lineHeight:e,borderRadius:.15*t+"px"})})(n)}      .disabled=${r}      onclick=${t}>RUN</button>  </div>`))({onClickRunButton:()=>{ft(wt),Ct.update(()=>({disabled:!0}))}}));K.subscribe(({width:t,height:e})=>{Ct.update(()=>({fontSize:Math.min(.04*t,.06*e)}))}),mt.subscribe(t=>{t.forEach(({direction:t,nextChar:e,nextState:n},i)=>Tt[i].update(()=>({state0:i>>1,char0:1&i,direction:t,char1:e,state1:n})))});const It=tt({display:"table-cell",position:"absolute",top:"19%",width:"100%",height:"10%",textAlign:"center",verticalAlign:"middle",fontFamily:"Courier New"}),Nt=(t,e)=>tt({margin:(e-t)/2+"px 0.5em",width:5*t+"px",height:t+"px",fontSize:t+"px",borderRadius:.15*t}),Wt=()=>ft($t),Rt=()=>ft(yt),Et=()=>ft(vt),Lt=Y({running:!1,disabled:!0,fontSize:0,height:0},t=>({running:e,disabled:n,fontSize:i,height:r})=>t`<div style=${It}>  <button    style=${Nt(i,r)}    onclick=${e?Rt:Wt}    .disabled=${n}>${e?"HALT":"RESET"}</button>  <button    style=${Nt(i,r)}    onclick=${Et}    .disabled=${n||e}>PASS</button></div>`);K.subscribe(({width:t,height:e})=>{Lt.update(()=>({fontSize:Math.min(.05*t,.065*e),height:.1*e}))});const Ot=()=>ft(St);var Ht=Y({opacity:0},t=>({opacity:e})=>t`<div style=${(t=>tt({display:0===t?"none":"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.6)",opacity:t}))(e)} onclick=${Ot}></div>`);const Ut={pass:{},solved:{},timeup:{}},Ft={type:Ut.pass,commandsSaved:0,accepted:!1,steps:0,timeLeft:0,opacity:0,fontSize:0},Bt=new Map([[Ut.pass,"#ccc"],[Ut.solved,"#cfc"],[Ut.timeup,"#ccf"]]),jt=new Map([[Ut.pass,"Pass"],[Ut.solved,"Solved!"],[Ut.timeup,"Time's up."]]),Dt=(t,e,n,i)=>100*(t+(e?1:0))*n*.1*(i/32)*3|0,Pt=Y(Ft,t=>({type:e,commandsSaved:n,accepted:i,steps:r,timeLeft:a,opacity:o,fontSize:s})=>t`<div style=${(t=>tt({display:0===t?"none":"block",position:"absolute",top:"10%",width:"100%",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}))(o)}>  <div style=${((t,e)=>tt({color:Bt.get(t),fontSize:e+"px"}))(e,1.3*s)}>${jt.get(e)}</div>  <table style=${(t=>tt({display:"inline-block",margin:t+"px 0",fontSize:t+"px",color:"white"}))(s)}>    <tr>      <td>Saved + accepted</td>      <td />      <td>Steps</td>      <td />      <td>Time left</td>    </tr>    <tr>      <td>((${n} + ${i?1:0}) &times; 100)</td>      <td>&times;</td>      <td>(${r} &times; 0.1)</td>      <td>&times;</td>      <td>(${pt(a)} / ${32}.00 &times; 3)</td>    </tr>  </table>  <div style=${(t=>tt({fontSize:t+"px"}))(s)}>Score: +${ct(Dt(n,i,r,a))}</div></div>`);K.subscribe(({width:t,height:e})=>{Pt.update(()=>({fontSize:Math.min(.04*t,.06*e)}))});const _t={finished:!1,order:Array(10).fill(0),tape:Array(10).fill(0),score:0,opacity:0,fontSize:0},qt=et(),Gt=et(),Zt={display:"inline-block"};[qt,Gt].forEach(t=>t.update(()=>({style:Zt})));const Jt=Y(_t,t=>({finished:e,caseNumber:n,order:i,tape:r,score:a,opacity:o,fontSize:s})=>(qt.update(()=>({tape:i,cellWidth:s})),Gt.update(()=>({tape:r,cellWidth:s})),t`<div style=${((t,e)=>tt({display:0===t?"none":"block",position:"absolute",top:"10%",width:"100%",fontSize:e+"px",lineHeight:e+"px",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}))(o,s)}>    <div style=${((t,e)=>tt({marginBottom:e+"px",fontSize:e+"px",color:t?"#fc9":"#c99"}))(e,1.3*s)}>${e?"Finished!":"Game Over"}</div>    <div style=${"display:"+(e?"none":"block")}>${e?"":"at No."+n}</div>    ${e?"":qt.render()}<br>${e?"":Gt.render()}<br>    <div style=${(t=>tt({fontSize:t+"px",marginTop:t+"px"}))(s)}>Total score: ${ct(a)}</div>  </div>`));K.subscribe(({width:t,height:e})=>{Jt.update(()=>({fontSize:Math.min(.04*t,.06*e)}))});const Kt=Y({opacity:0,fontSize:0},t=>({opacity:e,fontSize:n})=>t`<div style=${(t=>tt({display:0===t?"none":"block",position:"absolute",width:"100%",top:"30%",textAlign:"center",color:"white",opacity:t}))(e)}>    <div style=${(t=>tt({fontSize:t+"px",color:"orange"}))(n)}>TMP</div>  </div>`);K.subscribe(({width:t,height:e})=>{Kt.update(()=>({fontSize:3*Math.min(.04*t,.6*e)}))});var Qt={title:{title:{}},main:{programWindowOpening:{},programming:{},programWindowClosing:{},running:{}},result:{caseResult:{},totalResult:{}}};const{now:Vt}=O.globals,Xt=({startedAt:t})=>{const e=Math.max(32-(Vt()-t)/1e3,0);ut.update(()=>({timeLeft:e}))},Yt=(t,e)=>{const n=e-t,i=.2*n;return j<Math.abs(i)?t+i:t+Math.min(Math.max(-j,n),j)},te=({currentTape:t,position:e})=>{var n;n=t,G.next(t=>t.map((t,e)=>{const i=n[e];return t===i?t:Math.min(Math.max(t-D,i),t+D)})),it.update(({position:t})=>({position:Yt(t,e)}))},ee=(t,e)=>{const n=Math.max(50*(1-t/20),0),i=Math.min(50*(1+t/20),100),r=Math.min(87*Math.max((t-30)/10,0)+13,100),a=`polygon(${n}% 0, ${i}% 0, ${i}% ${r}%, ${n}% ${r}%)`;Ct.update(()=>({style:{clipPath:a},disabled:e}))},{now:ne,random:ie}=O.globals;var re=(t=0,e=0)=>({currentTape:n,position:i,machineState:r})=>{if(0===t){const t=q();return st(t),ut.update(()=>({number:1,timeLeft:32,score:0})),Ht.update(()=>({opacity:1})),{nextId:Qt.title.title,nextArgs:[1],stateUpdate:{position:0,machineState:0,order:t,currentTape:q()}}}if(te({currentTape:n,position:i}),rt.update(()=>({state:r})),t<30)return Kt.update(()=>({opacity:t/30})),{nextId:Qt.title.title,nextArgs:[t+1]};if(30===t)return{nextId:Qt.title.title,nextArgs:[bt()===St?31:30,(e+1)%30],stateUpdate:0===e?{currentTape:[...n.slice(0,i),Math.round(ie()),...n.slice(i+1,10)],position:{0:1,9:8}[i]||i+(ie()<.5?-1:1),machineState:Math.floor(5*ie())}:{}};if(t<50){const e=(50-t)/20;return Kt.update(()=>({opacity:e})),Ht.update(()=>({opacity:e})),{nextId:Qt.title.title,nextArgs:[t+1]}}Kt.update(()=>({opacity:0})),Ht.update(()=>({opacity:0})),mt.next(()=>ht);const a=q();return{nextId:Qt.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:1,score:0,order:q(),originalTape:a,currentTape:a,position:0,machinState:0,executedIndices:new Map,startedAt:ne()}}};const{now:ae}=O.globals,oe=(t,e,n)=>({type:t,time:0,accepted:e,timeLeft:n}),se=(t,e)=>(6*t+e)/7|0,{now:le}=O.globals,de=(t,e)=>Math.max(32-(t-e)/1e3,0);let ce=ht;mt.subscribe(t=>{ce=t});const pe=({currentTape:t,position:e,machineState:n,steps:i,executedIndices:r})=>{const a=n<<1|t[e],{direction:o,nextChar:s,nextState:l}=ce[a];return{currentTape:[...t.slice(0,e),s,...t.slice(e+1)],position:e+o,machineState:l,steps:i+1,executedIndices:new Set([...r,a])}},{now:ue}=O.globals,he=new Map([[Qt.title.title,re],[Qt.main.programWindowOpening,t=>e=>{st(e.order);const n=t<45;return ee(t,n),te(e),Lt.update(()=>({running:!1,disabled:n})),Xt(e),n?{nextId:Qt.main.programWindowOpening,nextArgs:[t+1]}:{nextId:Qt.main.programming,nextArgs:[]}}],[Qt.main.programming,()=>t=>{te(t),Xt(t);const e=bt();return e===wt?(rt.update(()=>({state:0})),{nextId:Qt.main.programWindowClosing,nextArgs:[45],stateUpdate:{currentTape:t.originalTape,machineState:0,position:0,runAt:le()}}):(e===$t&&mt.next(()=>ht),e===vt?{nextId:Qt.result.caseResult,nextArgs:[oe(Ut.pass,!1,de(le(),t.startedAt))],stateUpdate:{steps:0}}:{nextId:Qt.main.programming,nextArgs:[],stateUpdate:e===$t?{currentTape:t.originalTape,machineState:0,position:0}:{}})}],[Qt.main.programWindowClosing,t=>e=>(ee(t,!0),te(e),Lt.update(()=>({running:0===t,disabled:t>0})),0===t?{nextId:Qt.main.running,nextArgs:[0],stateUpdate:{steps:0,executedIndices:new Set}}:{nextId:Qt.main.programWindowClosing,nextArgs:[t-1]})],[Qt.main.running,t=>e=>{const{position:n,machineState:i,startedAt:r,runAt:a,order:o,currentTape:s}=e;if(bt()===yt)return rt.update(()=>({state:6})),de(le(),r)>0?{nextId:Qt.main.programWindowOpening,nextArgs:[0]}:{nextId:Qt.result.totalResult,nextArgs:[!1,0]};te(e);const l=n<0||n>=10?-1:i;if([-1,5].includes(l)&&30===t){if(rt.update(()=>({state:l})),o.join``===s.join``){const t=de(a,r),e=t>0?Ut.solved:Ut.timeup;return{nextId:Qt.result.caseResult,nextArgs:[oe(e,5===l,t)]}}return de(le(),r)>0?{nextId:Qt.main.programWindowOpening,nextArgs:[0],stateUpdate:{machineState:l}}:{nextId:Qt.result.totalResult,nextArgs:[!1,0]}}return rt.update(()=>({state:i})),{nextId:Qt.main.running,nextArgs:[30===t?0:t+1],stateUpdate:0===t?pe(e):{}}}],[Qt.result.caseResult,t=>({executedIndices:e,steps:n,caseNumber:i,score:r})=>{const{time:a,type:o,accepted:s,timeLeft:l}=t;Ht.update(()=>({opacity:Math.min(a/10,1)})),Pt.update(()=>({opacity:Math.min(Math.max(0,(a-10)/30),1)})),0===a&&(Pt.update(()=>({type:o,commandsSaved:10-e.size,accepted:s,steps:n,timeLeft:l})),Ct.update(()=>({disabled:!0}))),ut.update(({score:t})=>({score:40===a?r:se(t,r)}));const d=bt();if(a>=40&&d===St){if(Pt.update(()=>({opacity:0})),32===i)return{nextId:Qt.result.totalResult,nextArgs:[!0,0]};const t=i+1;ut.update(()=>({number:t}));const e=q();return Ht.update(()=>({opacity:0})),mt.next(()=>ht),rt.update(()=>({state:0})),{nextId:Qt.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:t,order:q(),originalTape:e,currentTape:e,position:0,machineState:0,executedIndices:new Map,startedAt:ae()}}}return{nextId:Qt.result.caseResult,nextArgs:[{...t,time:a+1}],stateUpdate:0===a?{score:r+Dt(10-e.size,s,n,l)}:{}}}],[Qt.result.totalResult,(t,e)=>({order:n,originalTape:i,score:r,caseNumber:a})=>{const o=bt();return e<=40?(Ht.update(()=>({opacity:Math.min(e/10,1)})),Jt.update(()=>({opacity:Math.max(0,(e-10)/30),finished:t,score:r,caseNumber:a,order:n,tape:i})),{nextId:Qt.result.totalResult,nextArgs:[t,e+1]}):41===e?{nextId:Qt.result.totalResult,nextArgs:[t,o===St?42:41]}:e<=61?(Jt.update(()=>({opacity:(61-e)/20})),{nextId:Qt.result.totalResult,nextArgs:[t,e+1]}):{nextId:Qt.title.title,nextArgs:[0]}}]]),me=(t,e)=>()=>{const{nextId:n,nextArgs:i,stateUpdate:r}=t(e);return me(he.get(n)(...i),{...e,...r})},{render:ge,html:xe}=O.uhtml;var fe,be;ge(document.getElementById("root"),xe`${[ut,dt,it,rt,Lt,Ct,Ht,Pt,Jt,Kt].map(t=>t.render())}`),B(me(re(0),(fe=q(),be=q(),{score:0,caseNumber:1,order:fe,originalTape:be,currentTape:be,position:0,machineState:0,startedAt:ue(),runAt:null,steps:0,executedIndices:new Set})),F)}();
