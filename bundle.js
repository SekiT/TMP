(function(){"use strict";var G=t=>({get:e=>t.get(e),set:(e,n)=>(t.set(e,n),n)});const gt=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,ue=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,fe=/<[a-z][^>]+$/i,$e=/>[^<>]*$/,ge=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/>)/ig,me=/\s+$/,mt=(t,e)=>0<e--&&(fe.test(t[e])||!$e.test(t[e])&&mt(t,e)),he=(t,e,n)=>ue.test(e)?t:`<${e}${n.replace(me,"")}></${e}>`;var ve=(t,e,n)=>{const r=[],{length:o}=t;for(let i=1;i<o;i++){const l=t[i-1];r.push(gt.test(l)&&mt(t,i)?l.replace(gt,(c,a,p)=>`${e}${i-1}=${p||'"'}${a}${p?"":'"'}`):`${l}<!--${e}${i-1}-->`)}r.push(t[o-1]);const s=r.join("").trim();return n?s:s.replace(ge,he)};const{isArray:V}=Array,{indexOf:ye,slice:ht}=[],be=1,vt=111,we=({firstChild:t,lastChild:e})=>{const n=document.createRange();return n.setStartAfter(t),n.setEndAfter(e),n.deleteContents(),t},Se=(t,e)=>t.nodeType===vt?1/e<0?e?we(t):t.lastChild:e?t.valueOf():t.firstChild:t,_e=t=>{const{childNodes:e}=t,{length:n}=e;if(n<2)return n?e[0]:t;const r=ht.call(e,0),o=r[0],s=r[n-1];return{ELEMENT_NODE:be,nodeType:vt,firstChild:o,lastChild:s,valueOf(){if(e.length!==n){let i=0;for(;i<n;)t.appendChild(r[i++])}return t}}};var xe=(t,e,n,r,o)=>{const s=n.length;let i=e.length,l=s,c=0,a=0,p=null;for(;c<i||a<l;)if(i===c){const f=l<s?a?r(n[a-1],-0).nextSibling:r(n[l-a],0):o;for(;a<l;)t.insertBefore(r(n[a++],1),f)}else if(l===a)for(;c<i;)(!p||!p.has(e[c]))&&t.removeChild(r(e[c],-1)),c++;else if(e[c]===n[a])c++,a++;else if(e[i-1]===n[l-1])i--,l--;else if(e[c]===n[l-1]&&n[a]===e[i-1]){const f=r(e[--i],-1).nextSibling;t.insertBefore(r(n[a++],1),r(e[c++],-1).nextSibling),t.insertBefore(r(n[--l],1),f),e[i]=n[l]}else{if(!p){p=new Map;let f=a;for(;f<l;)p.set(n[f],f++)}if(p.has(e[c])){const f=p.get(e[c]);if(a<f&&f<l){let j=c,$t=1;for(;++j<i&&j<l&&p.get(e[j])===f+$t;)$t++;if($t>f-a){const Fr=r(e[c],0);for(;a<f;)t.insertBefore(r(n[a++],1),Fr)}else t.replaceChild(r(n[a++],1),r(e[c++],-1))}else c++}else t.removeChild(r(e[c++],-1))}return n};const Oe=t=>e=>{for(const n in e){const r=n==="role"?n:`aria-${n}`,o=e[n];o==null?t.removeAttribute(r):t.setAttribute(r,o)}},Ae=(t,e)=>{let n,r=!0;const o=document.createAttributeNS(null,e);return s=>{n!==s&&(n=s,n==null?r||(t.removeAttributeNode(o),r=!0):(o.value=s,r&&(t.setAttributeNodeNS(o),r=!1)))}},Pe=(t,e,n)=>r=>{n!==!!r&&((n=!!r)?t.setAttribute(e,""):t.removeAttribute(e))},Te=({dataset:t})=>e=>{for(const n in e){const r=e[n];r==null?delete t[n]:t[n]=r}},yt=(t,e)=>{let n,r=e.slice(2);return!(e in t)&&e.toLowerCase()in t&&(r=r.toLowerCase()),o=>{const s=V(o)?o:[o,!1];n!==s[0]&&(n&&t.removeEventListener(r,n,s[1]),(n=s[0])&&t.addEventListener(r,n,s[1]))}},Ee=t=>{let e;return n=>{e!==n&&(e=n,typeof n=="function"?n(t):n.current=t)}},Ce=(t,e)=>e==="dataset"?Te(t):n=>{t[e]=n},Ie=t=>{let e;return n=>{e!=n&&(e=n,t.textContent=n==null?"":n)}};/*! (c) Andrea Giammarchi - ISC */var bt=function(t){var e="fragment",n="template",r="content"in i(n),o=r?function(c){var a=i(n);return a.innerHTML=c,a.content}:function(c){var a=i(e),p=i(n),f=null;if(/^[^\S]*?<(col(?:group)?|t(?:head|body|foot|r|d|h))/i.test(c)){var j=RegExp.$1;p.innerHTML="<table>"+c+"</table>",f=p.querySelectorAll(j)}else p.innerHTML=c,f=p.childNodes;return s(a,f),a};return function(a,p){return(p==="svg"?l:o)(a)};function s(c,a){for(var p=a.length;p--;)c.appendChild(a[0])}function i(c){return c===e?t.createDocumentFragment():t.createElementNS("http://www.w3.org/1999/xhtml",c)}function l(c){var a=i(e),p=i("div");return p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+c+"</svg>",s(a,p.firstChild.childNodes),a}}(document);const Me=({childNodes:t},e)=>t[e],q=t=>{const e=[];let{parentNode:n}=t;for(;n;)e.push(ye.call(n.childNodes,t)),t=n,n=t.parentNode;return e},{createTreeWalker:wt,importNode:X}=document,St=X.length!=1,Ne=St?(t,e,n)=>X.call(document,bt(t,e,n),!0):bt,Re=St?t=>wt.call(document,t,1|128,null,!1):t=>wt.call(document,t,1|128),_=(t,e,n)=>xe(t.parentNode,e,n,Se,t),je=t=>{let e,n,r=[];const o=s=>{switch(typeof s){case"string":case"number":case"boolean":e!==s&&(e=s,n||(n=document.createTextNode("")),n.data=s,r=_(t,r,[n]));break;case"object":case"undefined":if(s==null){e!=s&&(e=s,r=_(t,r,[]));break}if(V(s)){e=s,s.length===0?r=_(t,r,[]):typeof s[0]=="object"?r=_(t,r,s):o(String(s));break}e!==s&&"ELEMENT_NODE"in s&&(e=s,r=_(t,r,s.nodeType===11?ht.call(s.childNodes):[s]));break;case"function":o(s(t));break}};return o},Le=(t,e)=>{switch(e[0]){case"?":return Pe(t,e.slice(1),!1);case".":return Ce(t,e.slice(1));case"@":return yt(t,"on"+e.slice(1));case"o":if(e[1]==="n")return yt(t,e)}switch(e){case"ref":return Ee(t);case"aria":return Oe(t)}return Ae(t,e)};function ze(t){const{type:e,path:n}=t,r=n.reduceRight(Me,this);return e==="node"?je(r):e==="attr"?Le(r,t.name):Ie(r)}const x="is\xB5",_t=G(new WeakMap),ke=/^(?:plaintext|script|style|textarea|title|xmp)$/i,O=()=>({stack:[],entry:null,wire:null}),We=(t,e)=>{const{content:n,updates:r}=He(t,e);return{type:t,template:e,content:n,updates:r,wire:null}},De=(t,e)=>{const n=ve(e,x,t==="svg"),r=Ne(n,t),o=Re(r),s=[],i=e.length-1;let l=0,c=`${x}${l}`;for(;l<i;){const a=o.nextNode();if(!a)throw`bad template: ${n}`;if(a.nodeType===8)a.data===c&&(s.push({type:"node",path:q(a)}),c=`${x}${++l}`);else{for(;a.hasAttribute(c);)s.push({type:"attr",path:q(a),name:a.getAttribute(c)}),a.removeAttribute(c),c=`${x}${++l}`;ke.test(a.tagName)&&a.textContent.trim()===`<!--${c}-->`&&(a.textContent="",s.push({type:"text",path:q(a)}),c=`${x}${++l}`)}}return{content:r,nodes:s}},He=(t,e)=>{const{content:n,nodes:r}=_t.get(e)||_t.set(e,De(t,e)),o=X.call(document,n,!0),s=r.map(ze,o);return{content:o,updates:s}},L=(t,{type:e,template:n,values:r})=>{const{length:o}=r;xt(t,r,o);let{entry:s}=t;(!s||s.template!==n||s.type!==e)&&(t.entry=s=We(e,n));const{content:i,updates:l,wire:c}=s;for(let a=0;a<o;a++)l[a](r[a]);return c||(s.wire=_e(i))},xt=({stack:t},e,n)=>{for(let r=0;r<n;r++){const o=e[r];o instanceof Z?e[r]=L(t[r]||(t[r]=O()),o):V(o)?xt(t[r]||(t[r]=O()),o,o.length):t[r]=null}n<t.length&&t.splice(n)};function Z(t,e,n){this.type=t,this.template=e,this.values=n}const{create:Ue,defineProperties:Fe}=Object,Ot=t=>{const e=G(new WeakMap),n=r=>(o,...s)=>L(r,{type:t,template:o,values:s});return Fe((r,...o)=>new Z(t,r,o),{for:{value(r,o){const s=e.get(r)||e.set(r,Ue(null));return s[o]||(s[o]=n(O()))}},node:{value:(r,...o)=>L(O(),{type:t,template:r,values:o}).valueOf()}})},At=G(new WeakMap),Be=(t,e)=>{const n=typeof e=="function"?e():e,r=At.get(t)||At.set(t,O()),o=n instanceof Z?L(r,n):n;return o!==r.wire&&(r.wire=o,t.textContent="",t.appendChild(o.valueOf())),t},Ge=Ot("html");Ot("svg");var m={uhtml:{render:Be,html:Ge},globals:{now:Date.now,window,setTimeout,random:Math.random,DocumentFragment}};const{now:Pt,setTimeout:Ve}=m.globals,Tt=1e3/60,Et=(t,e)=>{const n=Pt(),r=t();Ve(()=>{const o=Pt()<n+Tt?e+1:Math.max(e-1,1);Et(r,o)},e)},Ct=32,A=32,qe=1/5,J=1/15,It=1/15,Mt=45,K=30;var Q=t=>{let e=t;const n=new Map;return{next:r=>{e=r(e),n.forEach(o=>o(e))},subscribe:r=>{r(e);const o={};return n.set(o,r),o},unsubscribe:r=>n.delete(r)}};const{random:Xe}=m.globals,h=()=>[...Array(10)].map(()=>Math.round(Xe())),Y=Q(h()),Ze=t=>{Y.next(e=>e.map((n,r)=>{const o=t[r];return n===o?n:Math.min(Math.max(n-It,o),n+It)}))};var Je=Object.defineProperty,Nt=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,Rt=(t,e,n)=>e in t?Je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jt=(t,e)=>{for(var n in e||(e={}))Ke.call(e,n)&&Rt(t,n,e[n]);if(Nt)for(var n of Nt(e))Qe.call(e,n)&&Rt(t,n,e[n]);return t};const{render:Ye,html:tn}=m.uhtml,{DocumentFragment:en}=m.globals,$=(t,e)=>{const n=new en,r=s=>Ye(n,e(tn)(s));let o=t;return{render:()=>r(o),update:s=>{o=jt(jt({},o),s(o)),r(o)}}},nn=t=>t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),u=t=>Object.entries(t).reduce((e,[n,r])=>`${e}${nn(n)}:${r};`,"");var rn=Object.defineProperty,Lt=Object.getOwnPropertySymbols,on=Object.prototype.hasOwnProperty,sn=Object.prototype.propertyIsEnumerable,zt=(t,e,n)=>e in t?rn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,an=(t,e)=>{for(var n in e||(e={}))on.call(e,n)&&zt(t,n,e[n]);if(Lt)for(var n of Lt(e))sn.call(e,n)&&zt(t,n,e[n]);return t};const cn=(t,e)=>$({bit:t},n=>({bit:r})=>{const o=255*r,s=255-o,i=u({display:"inline-block",width:e,height:e,lineHeight:e,fontSize:e,textAlign:"center",backgroundColor:`rgb(${o},${o},${o})`,color:`rgb(${s},${s},${s})`});return n`<div style=${i}>${r<.5?0:1}</div>`});var P=(t,e)=>{const n={tape:h(),style:{}},r=`min(${t}vw, ${e}vh)`,o=n.tape.map(s=>cn(s,r));return $(n,s=>({tape:i,style:l})=>{const c=u(an({width:`calc(${r} * 10)`,height:r},l));return o.forEach((a,p)=>a.update(()=>({bit:i[p]}))),s`<div style=${c}>${o.map(a=>a.render())}</div>`})};const kt=P(15,30),Wt=$({position:0},t=>({position:e})=>{const n=u({position:"absolute",top:"30%",left:"50%",transform:`translateX(calc(-5% - ${e} * 10%))`});return t`<div style=${n}>${kt.render()}</div>`});Y.subscribe(t=>kt.update(()=>({tape:t})));var ln=Object.defineProperty,dn=Object.defineProperties,pn=Object.getOwnPropertyDescriptors,Dt=Object.getOwnPropertySymbols,un=Object.prototype.hasOwnProperty,fn=Object.prototype.propertyIsEnumerable,Ht=(t,e,n)=>e in t?ln(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tt=(t,e)=>{for(var n in e||(e={}))un.call(e,n)&&Ht(t,n,e[n]);if(Dt)for(var n of Dt(e))fn.call(e,n)&&Ht(t,n,e[n]);return t},et=(t,e)=>dn(t,pn(e));const $n={state:0},gn=t=>"E01234AH"[t+1],y="min(15vw, 30vh)",z=`calc(${y} / 16)`,mn=u({position:"absolute",top:"30%",left:`calc(50% - ${y} * 9 / 16)`}),Ut={position:"absolute",height:y,background:"radial-gradient(#aaa, #666)"},Ft=et(tt({},Ut),{width:`calc(${y} / 8)`,borderRadius:`${z} ${z} 0 0`}),hn=u(Ft),vn=u(et(tt({},Ft),{left:y})),yn=u(et(tt({},Ut),{top:y,width:`calc(${y} * 9 / 8)`,borderRadius:`0 0 ${z} ${z}`,fontSize:`calc(${y} * 0.8)`,lineHeight:y,textAlign:"center",color:"white"})),b=$($n,t=>({state:e})=>t`<div style=${mn}>    <div style=${hn} />    <div style=${vn} />    <div style=${yn}>${gn(e)}</div>  </div>`),Bt=P(5,7),Gt=P(5,7),Vt=t=>Bt.update(()=>({tape:t})),bn=u({position:"absolute",top:"3%",width:"100%",fontFamily:"serif",color:"white"}),wn=u({margin:"0 auto",fontSize:"min(3vw, 4.2vh)",lineHeight:"min(3vw, 4.2vh)"}),Sn=$({},t=>()=>t`<div style=${bn}>  <table style=${wn}>    <tr><td>ORDER:</td><td>${Bt.render()}</td></tr>    <tr><td>TAPE:</td><td>${Gt.render()}</td></tr>  </table></div>`);Y.subscribe(t=>Gt.update(()=>({tape:t})));const _n={number:1,timeLeft:0,score:0},nt="min(3vw, 4.2vh)",xn=u({position:"absolute",top:"1%",left:"1%",fontSize:nt,color:"white",fontFamily:"serif"}),On=u({fontSize:`calc(${nt} * 0.7)`}),An=u({position:"absolute",bottom:"1%",left:"1%",fontSize:nt,color:"white",fontFamily:"serif"}),rt=t=>[...t.toString()].reduceRight(([e,n],r)=>e.length===3?[r,`,${e}${n}`]:[`${r}${e}`,n],["",""]).join``,qt=t=>(t*100|0).toString().padStart(4,"0").replace(/^(..)(..)/,"$1.$2"),T=$(_n,t=>({number:e,timeLeft:n,score:r})=>t`  <div style=${xn}>    No.${e}<span style=${On}>/${Ct}</span><br>    ${qt(n)}  </div>  <div style=${An}>Score: ${rt(r)}</div>`),E=[...Array(10)].map((t,e)=>({direction:1,nextChar:e&1,nextState:e>>1})),S=Q(E),ot=(t,e)=>S.next(n=>[...n.slice(0,t),e(n[t]),...n.slice(t+1)]),Xt=Q([]),C=t=>Xt.next(e=>[...e,t]),I=()=>{let t;return Xt.next(([e,...n])=>(t=e,n)),t},g={reset:{},halt:{},pass:{},run:{},goNext:{}};var Pn=Object.defineProperty,Tn=Object.defineProperties,En=Object.getOwnPropertyDescriptors,Zt=Object.getOwnPropertySymbols,Cn=Object.prototype.hasOwnProperty,In=Object.prototype.propertyIsEnumerable,Jt=(t,e,n)=>e in t?Pn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,st=(t,e)=>{for(var n in e||(e={}))Cn.call(e,n)&&Jt(t,n,e[n]);if(Zt)for(var n of Zt(e))In.call(e,n)&&Jt(t,n,e[n]);return t},at=(t,e)=>Tn(t,En(e));const Mn=(t,e)=>({state0:t,char0:e,direction:1,char1:e,state1:t,disabled:!1}),Nn=u({display:"inline-block",margin:"1% 1%",textAlign:"center",whiteSpace:"nowrap"}),Rn=t=>t<0?"L":"R",jn=["0","1","2","3","4","A"],Ln=(t,e)=>()=>{ot(t,n=>at(st({},n),{direction:-e}))},zn=(t,e)=>()=>{ot(t,n=>at(st({},n),{nextChar:1-e}))},kn=(t,e)=>()=>{ot(t,n=>at(st({},n),{nextState:(e+1)%6}))};var Wn=t=>$(Mn(t>>1,t&0),e=>({state0:n,char0:r,direction:o,char1:s,state1:i,disabled:l})=>e`<div style=${Nn}>${`<${n},${r},`}<button onclick=${Ln(t,o)} .disabled=${l}>${Rn(o)}</button>${","}<button onclick=${zn(t,s)} .disabled=${l}>${s}</button>${","}<button onclick=${kn(t,i)} .disabled=${l}>${jn[i]}</button>${">"}</div>`),Dn=Object.defineProperty,Kt=Object.getOwnPropertySymbols,Hn=Object.prototype.hasOwnProperty,Un=Object.prototype.propertyIsEnumerable,Qt=(t,e,n)=>e in t?Dn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fn=(t,e)=>{for(var n in e||(e={}))Hn.call(e,n)&&Qt(t,n,e[n]);if(Kt)for(var n of Kt(e))Un.call(e,n)&&Qt(t,n,e[n]);return t};const Bn={style:{display:"none"},disabled:!0},it=[...Array(10)].map((t,e)=>Wn(e)),M="min(4vw, 6vh)",Gn=t=>u(Fn({position:"absolute",top:"29%",left:"50%",transform:"translate(-50%, 0)",width:`calc(${M} * 20)`,padding:"5px 0 10px 0",textAlign:"center",fontSize:M,lineHeight:M,border:"1px solid #999",backgroundColor:"rgba(51, 51, 153, 0.8)",color:"white",fontFamily:"Courier New"},t)),Vn=u({marginBottom:"10px"}),ct=`calc(${M} * 1.3)`,qn=u({height:ct,marginTop:"0.1em",padding:"0 1em",fontSize:ct,lineHeight:ct,borderRadius:`calc(${M} * 0.15)`}),k=$(Bn,(({onClickRunButton:t})=>e=>({style:n,disabled:r})=>(it.forEach(o=>o.update(()=>({disabled:r}))),e`<div style=${Gn(n)}>    <span style=${Vn}>Program</span>    <div>${it.map(o=>o.render())}</div>    <button      style=${qn}      .disabled=${r}      onclick=${t}>RUN</button>  </div>`))({onClickRunButton:()=>{C(g.run),k.update(()=>({disabled:!0}))}}));S.subscribe(t=>{t.forEach(({direction:e,nextChar:n,nextState:r},o)=>it[o].update(()=>({state0:o>>1,char0:o&1,direction:e,char1:n,state1:r})))});const Xn={running:!1,disabled:!0},Zn=u({display:"table-cell",position:"absolute",top:"19%",width:"100%",height:"10%",textAlign:"center",verticalAlign:"middle",fontFamily:"Courier New"}),N="min(5vw, 6.5vh)",Yt=u({margin:`calc(5vh - ${N} / 2) 0.5em`,width:`calc(${N} * 5)`,height:N,fontSize:N,borderRadius:`calc(${N} * 0.15)`}),Jn=()=>C(g.reset),Kn=()=>C(g.halt),Qn=()=>C(g.pass),lt=$(Xn,t=>({running:e,disabled:n})=>t`<div style=${Zn}>    <button      style=${Yt}      onclick=${e?Kn:Jn}      .disabled=${n}>${e?"HALT":"RESET"}</button>    <button      style=${Yt}      onclick=${Qn}      .disabled=${n||e}>PASS</button>  </div>`),Yn=t=>u({display:t===0?"none":"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.6)",opacity:t}),tr=()=>C(g.goNext);var w=$({opacity:0},t=>({opacity:e})=>t`<div style=${Yn(e)} onclick=${tr}></div>`);const v={pass:{},solved:{},timeup:{}},er={type:v.pass,commandsSaved:0,accepted:!1,steps:0,timeLeft:0,opacity:0},nr=t=>u({display:t===0?"none":"block",position:"absolute",top:"10%",width:"100%",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}),rr=new Map([[v.pass,"#ccc"],[v.solved,"#cfc"],[v.timeup,"#ccf"]]),W="min(4vw, 6vh)",or=t=>u({color:rr.get(t),fontSize:`calc(${W} * 1.3)`}),sr=new Map([[v.pass,"Pass"],[v.solved,"Solved!"],[v.timeup,"Time's up."]]),ar=u({display:"inline-block",margin:`${W} 0`,fontSize:W,color:"white"}),ir=u({fontSize:W}),te=(t,e,n,r)=>(t+(e?1:0))*100*n*.1*(r/A)*3|0,D=$(er,t=>({type:e,commandsSaved:n,accepted:r,steps:o,timeLeft:s,opacity:i})=>t`<div style=${nr(i)}>    <div style=${or(e)}>${sr.get(e)}</div>    <table style=${ar}>      <tr>        <td>Saved + accepted</td>        <td />        <td>Steps</td>        <td />        <td>Time left</td>      </tr>      <tr>        <td>((${n} + ${r?1:0}) &times; 100)</td>        <td>&times;</td>        <td>(${o} &times; 0.1)</td>        <td>&times;</td>        <td>(${qt(s)} / ${A}.00 &times; 3)</td>      </tr>    </table>    <div style=${ir}>Score: +${rt(te(n,r,o,s))}</div>  </div>`),cr={finished:!1,order:Array(10).fill(0),tape:Array(10).fill(0),score:0,opacity:0},lr=(t,e)=>u({display:t===0?"none":"block",position:"absolute",top:"10%",width:"100%",fontSize:`${e}px`,lineHeight:`${e}px`,textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}),H="min(4vw, 6vh)",dr=t=>u({marginBottom:H,fontSize:`calc(${H} * 1.3)`,color:t?"#fc9":"#c99"}),dt=P(4,6),pt=P(4,6),pr={display:"inline-block"};[dt,pt].forEach(t=>t.update(()=>({style:pr})));const ur=u({fontSize:H,marginTop:H}),ut=$(cr,t=>({finished:e,caseNumber:n,order:r,tape:o,score:s,opacity:i})=>(dt.update(()=>({tape:r})),pt.update(()=>({tape:o})),t`<div style=${lr(i)}>    <div style=${dr(e)}>${e?"Finished!":"Game Over"}</div>    <div style=${`display:${e?"none":"block"}`}>${e?"":`at No.${n}`}</div>    ${e?"":dt.render()}<br>${e?"":pt.render()}<br>    <div style=${ur}>Total score: ${rt(s)}</div>  </div>`)),fr={opacity:0},$r=t=>u({display:t===0?"none":"block",position:"absolute",width:"100%",top:"30%",textAlign:"center",color:"white",opacity:t}),gr=u({fontSize:"min(12vw, 18vh)",color:"orange"}),U=$(fr,t=>({opacity:e})=>t`<div style=${$r(e)}>    <div style=${gr}>TMP</div>  </div>`);var d={title:{title:{}},main:{programWindowOpening:{},programming:{},programWindowClosing:{},running:{}},result:{caseResult:{},totalResult:{}}};const{now:mr}=m.globals,ee=({startedAt:t})=>{const e=Math.max(A-(mr()-t)/1e3,0);T.update(()=>({timeLeft:e}))},hr=(t,e)=>{const n=e-t,r=n*qe;return J<Math.abs(r)?t+r:t+Math.min(Math.max(-J,n),J)},R=({currentTape:t,position:e})=>{Ze(t),Wt.update(({position:n})=>({position:hr(n,e)}))},ne=(t,e)=>{const n=Math.max((1-t/20)*50,0),r=Math.min((1+t/20)*50,100),o=Math.min(Math.max((t-30)/10,0)*87+13,100),s=`polygon(${n}% 0, ${r}% 0, ${r}% ${o}%, ${n}% ${o}%)`;k.update(()=>({style:{clipPath:s},disabled:e}))},{now:vr,random:ft}=m.globals;var re=(t=0,e=0)=>({currentTape:n,position:r,machineState:o})=>{if(t===0){const i=h();return Vt(i),T.update(()=>({number:1,timeLeft:A,score:0})),w.update(()=>({opacity:1})),{nextId:d.title.title,nextArgs:[1],stateUpdate:{position:0,machineState:0,order:i,currentTape:h()}}}if(R({currentTape:n,position:r}),b.update(()=>({state:o})),t<30)return U.update(()=>({opacity:t/30})),{nextId:d.title.title,nextArgs:[t+1]};if(t===30)return{nextId:d.title.title,nextArgs:[I()===g.goNext?31:30,(e+1)%K],stateUpdate:e===0?{currentTape:[...n.slice(0,r),Math.round(ft()),...n.slice(r+1,10)],position:{0:1,9:8}[r]||r+(ft()<.5?-1:1),machineState:Math.floor(ft()*5)}:{}};if(t<50){const i=(50-t)/20;return U.update(()=>({opacity:i})),w.update(()=>({opacity:i})),{nextId:d.title.title,nextArgs:[t+1]}}U.update(()=>({opacity:0})),w.update(()=>({opacity:0})),S.next(()=>E);const s=h();return{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:1,score:0,order:h(),originalTape:s,currentTape:s,position:0,machinState:0,executedIndices:new Map,startedAt:vr()}}},yr=Object.defineProperty,br=Object.defineProperties,wr=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,Sr=Object.prototype.hasOwnProperty,_r=Object.prototype.propertyIsEnumerable,se=(t,e,n)=>e in t?yr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xr=(t,e)=>{for(var n in e||(e={}))Sr.call(e,n)&&se(t,n,e[n]);if(oe)for(var n of oe(e))_r.call(e,n)&&se(t,n,e[n]);return t},Or=(t,e)=>br(t,wr(e));const{now:Ar}=m.globals,ae=(t,e,n)=>({type:t,time:0,accepted:e,timeLeft:n}),Pr=(t,e)=>(t*6+e)/7|0,Tr=t=>({executedIndices:e,steps:n,caseNumber:r,score:o})=>{const{time:s,type:i,accepted:l,timeLeft:c}=t;w.update(()=>({opacity:Math.min(s/10,1)})),D.update(()=>({opacity:Math.min(Math.max(0,(s-10)/30),1)})),s===0&&(D.update(()=>({type:i,commandsSaved:10-e.size,accepted:l,steps:n,timeLeft:c})),k.update(()=>({disabled:!0}))),T.update(({score:p})=>({score:s===40?o:Pr(p,o)}));const a=I();if(s>=40&&a===g.goNext){if(D.update(()=>({opacity:0})),r===Ct)return{nextId:d.result.totalResult,nextArgs:[!0,0]};const p=r+1;T.update(()=>({number:p}));const f=h();return w.update(()=>({opacity:0})),S.next(()=>E),b.update(()=>({state:0})),{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:p,order:h(),originalTape:f,currentTape:f,position:0,machineState:0,executedIndices:new Map,startedAt:Ar()}}}return{nextId:d.result.caseResult,nextArgs:[Or(xr({},t),{time:s+1})],stateUpdate:s===0?{score:o+te(10-e.size,l,n,c)}:{}}},Er=(t,e)=>({order:n,originalTape:r,score:o,caseNumber:s})=>{const i=I();return e<=40?(w.update(()=>({opacity:Math.min(e/10,1)})),ut.update(()=>({opacity:Math.max(0,(e-10)/30),finished:t,score:o,caseNumber:s,order:n,tape:r})),{nextId:d.result.totalResult,nextArgs:[t,e+1]}):e===41?{nextId:d.result.totalResult,nextArgs:[t,i===g.goNext?42:41]}:e<=61?(ut.update(()=>({opacity:(61-e)/20})),{nextId:d.result.totalResult,nextArgs:[t,e+1]}):{nextId:d.title.title,nextArgs:[0]}},{now:F}=m.globals,B=(t,e)=>Math.max(A-(t-e)/1e3,0),Cr=t=>e=>{Vt(e.order);const n=t<Mt;return ne(t,n),R(e),lt.update(()=>({running:!1,disabled:n})),ee(e),n?{nextId:d.main.programWindowOpening,nextArgs:[t+1]}:{nextId:d.main.programming,nextArgs:[]}},Ir=()=>t=>{R(t),ee(t);const e=I();return e===g.run?(b.update(()=>({state:0})),{nextId:d.main.programWindowClosing,nextArgs:[Mt],stateUpdate:{currentTape:t.originalTape,machineState:0,position:0,runAt:F()}}):(e===g.reset&&S.next(()=>E),e===g.pass?{nextId:d.result.caseResult,nextArgs:[ae(v.pass,!1,B(F(),t.startedAt))],stateUpdate:{steps:0}}:{nextId:d.main.programming,nextArgs:[],stateUpdate:e===g.reset?{currentTape:t.originalTape,machineState:0,position:0}:{}})},Mr=t=>e=>(ne(t,!0),R(e),lt.update(()=>({running:t===0,disabled:t>0})),t===0?{nextId:d.main.running,nextArgs:[0],stateUpdate:{steps:0,executedIndices:new Set}}:{nextId:d.main.programWindowClosing,nextArgs:[t-1]});let ie=E;S.subscribe(t=>{ie=t});const Nr=({currentTape:t,position:e,machineState:n,steps:r,executedIndices:o})=>{const s=n<<1|t[e],{direction:i,nextChar:l,nextState:c}=ie[s];return{currentTape:[...t.slice(0,e),l,...t.slice(e+1)],position:e+i,machineState:c,steps:r+1,executedIndices:new Set([...o,s])}},Rr=t=>e=>{const{position:n,machineState:r,startedAt:o,runAt:s,order:i,currentTape:l}=e;if(I()===g.halt)return b.update(()=>({state:6})),B(F(),o)>0?{nextId:d.main.programWindowOpening,nextArgs:[0]}:{nextId:d.result.totalResult,nextArgs:[!1,0]};R(e);const c=n<0||n>=10?-1:r;if([-1,5].includes(c)&&t===K){if(b.update(()=>({state:c})),i.join``===l.join``){const a=B(s,o),p=a>0?v.solved:v.timeup;return{nextId:d.result.caseResult,nextArgs:[ae(p,c===5,a)]}}return B(F(),o)>0?{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{machineState:c}}:{nextId:d.result.totalResult,nextArgs:[!1,0]}}return b.update(()=>({state:r})),{nextId:d.main.running,nextArgs:[t===K?0:t+1],stateUpdate:t===0?Nr(e):{}}};var jr=Object.defineProperty,ce=Object.getOwnPropertySymbols,Lr=Object.prototype.hasOwnProperty,zr=Object.prototype.propertyIsEnumerable,le=(t,e,n)=>e in t?jr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,de=(t,e)=>{for(var n in e||(e={}))Lr.call(e,n)&&le(t,n,e[n]);if(ce)for(var n of ce(e))zr.call(e,n)&&le(t,n,e[n]);return t};const{now:kr}=m.globals,Wr=new Map([[d.title.title,re],[d.main.programWindowOpening,Cr],[d.main.programming,Ir],[d.main.programWindowClosing,Mr],[d.main.running,Rr],[d.result.caseResult,Tr],[d.result.totalResult,Er]]),Dr=(t,e)=>({score:0,caseNumber:1,order:t,originalTape:e,currentTape:e,position:0,machineState:0,startedAt:kr(),runAt:null,steps:0,executedIndices:new Set}),pe=(t,e)=>()=>{const{nextId:n,nextArgs:r,stateUpdate:o}=t(e);return pe(Wr.get(n)(...r),de(de({},e),o))},{render:Hr,html:Ur}=m.uhtml;Hr(document.getElementById("root"),Ur`${[T,Sn,Wt,b,lt,k,w,D,ut,U].map(t=>t.render())}`),Et(pe(re(0),Dr(h(),h())),Tt)})();
