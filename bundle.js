(function(){"use strict";var re=(t,e,n,s,i)=>{const r=n.length;let a=e.length,o=r,c=0,p=0,l=null;for(;c<a||p<o;)if(a===c){const $=o<r?p?s(n[p-1],-0).nextSibling:s(n[o],0):i;for(;p<o;)t.insertBefore(s(n[p++],1),$)}else if(o===p)for(;c<a;)(!l||!l.has(e[c]))&&t.removeChild(s(e[c],-1)),c++;else if(e[c]===n[p])c++,p++;else if(e[a-1]===n[o-1])a--,o--;else if(e[c]===n[o-1]&&n[p]===e[a-1]){const $=s(e[--a],-0).nextSibling;t.insertBefore(s(n[p++],1),s(e[c++],-0).nextSibling),t.insertBefore(s(n[--o],1),$),e[a]=n[o]}else{if(!l){l=new Map;let $=p;for(;$<o;)l.set(n[$],$++)}if(l.has(e[c])){const $=l.get(e[c]);if(p<$&&$<o){let h=c,f=1;for(;++h<a&&h<o&&l.get(e[h])===$+f;)f++;if(f>$-p){const C=s(e[c],0);for(;p<$;)t.insertBefore(s(n[p++],1),C)}else t.replaceChild(s(n[p++],1),s(e[c++],-1))}else c++}else t.removeChild(s(e[c++],-1))}return n};const{isArray:At}=Array,{getPrototypeOf:oe,getOwnPropertyDescriptor:ae}=Object,ce="http://www.w3.org/2000/svg",v=[],Tt=()=>document.createRange(),tt=(t,e,n)=>(t.set(e,n),n),le=(t,e)=>{let n;do n=ae(t,e);while(!n&&(t=oe(t)));return n},de=(t,e)=>e.reduceRight(pe,t),pe=(t,e)=>t.childNodes[e],ue=1,$e=8,he=11,{setPrototypeOf:me}=Object;var ge=t=>{function e(n){return me(n,new.target.prototype)}return e.prototype=t.prototype,e};let T;var Mt=(t,e,n)=>(T||(T=Tt()),n?T.setStartAfter(t):T.setStartBefore(t),T.setEndAfter(e),T.deleteContents(),t);const et=({firstChild:t,lastChild:e},n)=>Mt(t,e,n);let Et=!1;const nt=(t,e)=>Et&&t.nodeType===he?1/e<0?e?et(t,!0):t.lastChild:e?t.valueOf():t.firstChild:t,Ct=t=>document.createComment(t);class fe extends ge(DocumentFragment){#e=Ct("<>");#n=Ct("</>");#t=v;constructor(e){super(e),this.replaceChildren(this.#e,...e.childNodes,this.#n),Et=!0}get firstChild(){return this.#e}get lastChild(){return this.#n}get parentNode(){return this.#e.parentNode}remove(){et(this,!1)}replaceWith(e){et(this,!0).replaceWith(e)}valueOf(){const{parentNode:e}=this;if(e===this)this.#t===v&&(this.#t=[...this.childNodes]);else{if(e){let{firstChild:n,lastChild:s}=this;for(this.#t=[n];n!==s;)this.#t.push(n=n.nextSibling)}this.replaceChildren(...this.#t)}return this}}const Nt=(t,e,n)=>t.setAttribute(e,n),H=(t,e)=>t.removeAttribute(e),be=(t,e)=>{for(const n in e){const s=e[n],i=n==="role"?n:`aria-${n}`;s==null?H(t,i):Nt(t,i,s)}return e};let B;const xe=(t,e,n)=>{n=n.slice(1),B||(B=new WeakMap);const s=B.get(t)||tt(B,t,{});let i=s[n];return i&&i[0]&&t.removeEventListener(n,...i),i=At(e)?e:[e,!1],s[n]=i,i[0]&&t.addEventListener(n,...i),e},N=(t,e)=>{const{t:n,n:s}=t;let i=!1;switch(typeof e){case"object":if(e!==null){(s||n).replaceWith(t.n=e.valueOf());break}case"undefined":i=!0;default:n.data=i?"":e,s&&(t.n=null,s.replaceWith(n));break}return e},ye=(t,e)=>st(t,e,e==null?"class":"className"),we=(t,e)=>{const{dataset:n}=t;for(const s in e)e[s]==null?delete n[s]:n[s]=e[s];return e},j=(t,e,n)=>t[n]=e,ve=(t,e,n)=>j(t,e,n.slice(1)),st=(t,e,n)=>e==null?(H(t,n),e):j(t,e,n),It=(t,e)=>(typeof e=="function"?e(t):e.current=t,e),it=(t,e,n)=>(e==null?H(t,n):Nt(t,n,e),e),Se=(t,e)=>e==null?st(t,e,"style"):j(t.style,e,"cssText"),Ae=(t,e,n)=>(t.toggleAttribute(n.slice(1),e),e),V=(t,e,n)=>{const{length:s}=e;if(t.data=`[${s}]`,s)return re(t.parentNode,n,e,nt,t);switch(n.length){case 1:n[0].remove();case 0:break;default:Mt(nt(n[0],0),nt(n.at(-1),-0),!1);break}return v},Te=new Map([["aria",be],["class",ye],["data",we],["ref",It],["style",Se]]),Me=(t,e,n)=>{switch(e[0]){case".":return ve;case"?":return Ae;case"@":return xe;default:return n||"ownerSVGElement"in t?e==="ref"?It:it:Te.get(e)||(e in t?e.startsWith("on")?j:le(t,e)?.set?st:it:it)}},Ee=(t,e)=>(t.textContent=e??"",e),I=(t,e,n)=>({a:t,b:e,c:n}),Ce=(t,e)=>({b:t,c:e}),Ne=(t,e,n,s)=>({v,u:t,t:e,n,c:s}),k=()=>I(null,null,v);var kt=t=>((e,n)=>{const{a:s,b:i,c:r}=t(e,n),a=document.importNode(s,!0);let o=v;if(i!==v){o=[];for(let c,p,l=0;l<i.length;l++){const{a:$,b:h,c:f}=i[l],C=$===p?c:c=de(a,p=$);o[l]=Ne(h,C,f,h===V?[]:h===N?k():null)}}return Ce(r?a.firstChild:new fe(a),o)});const Ie=/^(?:plaintext|script|style|textarea|title|xmp)$/i,ke=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Oe=/<([a-zA-Z0-9]+[a-zA-Z0-9:._-]*)([^>]*?)(\/?)>/g,Re=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,We=/[\x01\x02]/g;var Le=(t,e,n)=>{let s=0;return t.join("").trim().replace(Oe,(i,r,a,o)=>`<${r}${a.replace(Re,"=$2$1").trimEnd()}${o?n||ke.test(r)?" /":`></${r}`:""}>`).replace(We,i=>i===""?`<!--${e+s++}-->`:e+s++)};let G=document.createElement("template"),rt,ot;var _e=(t,e)=>{if(e)return rt||(rt=document.createElementNS(ce,"svg"),ot=Tt(),ot.selectNodeContents(rt)),ot.createContextualFragment(t);G.innerHTML=t;const{content:n}=G;return G=G.cloneNode(!1),n};const at=t=>{const e=[];let n;for(;n=t.parentNode;)e.push(e.indexOf.call(n.childNodes,t)),t=n;return e},Ot=()=>document.createTextNode(""),ze=(t,e,n)=>{const s=_e(Le(t,O,n),n),{length:i}=t;let r=v;if(i>1){const c=[],p=document.createTreeWalker(s,129);let l=0,$=`${O}${l++}`;for(r=[];l<i;){const h=p.nextNode();if(h.nodeType===$e){if(h.data===$){const f=At(e[l-1])?V:N;f===N&&c.push(h),r.push(I(at(h),f,null)),$=`${O}${l++}`}}else{let f;for(;h.hasAttribute($);){f||(f=at(h));const C=h.getAttribute($);r.push(I(f,Me(h,C,n),C)),H(h,$),$=`${O}${l++}`}!n&&Ie.test(h.localName)&&h.textContent.trim()===`<!--${$}-->`&&(r.push(I(f||at(h),Ee,null)),$=`${O}${l++}`)}}for(l=0;l<c.length;l++)c[l].replaceWith(Ot())}const{childNodes:a}=s;let{length:o}=a;return o<1?(o=1,s.appendChild(Ot())):o===1&&i!==1&&a[0].nodeType!==ue&&(o=0),tt(Rt,t,I(s,r,o===1))},Rt=new WeakMap,O="is\xB5";var Wt=t=>(e,n)=>Rt.get(e)||ze(e,n,t);const Pe=kt(Wt(!1)),De=kt(Wt(!0)),ct=(t,{s:e,t:n,v:s})=>{if(t.a!==n){const{b:i,c:r}=(e?De:Pe)(n,s);t.a=n,t.b=i,t.c=r}for(let{c:i}=t,r=0;r<i.length;r++){const a=s[r],o=i[r];switch(o.u){case V:o.v=V(o.t,Ue(o.c,a),o.v);break;case N:const c=a instanceof lt?ct(o.c||(o.c=k()),a):(o.c=null,a);c!==o.v&&(o.v=N(o,c));break;default:a!==o.v&&(o.v=o.u(o.t,a,o.n,o.v));break}}return t.b},Ue=(t,e)=>{let n=0,{length:s}=e;for(s<t.length&&t.splice(s);n<s;n++){const i=e[n];i instanceof lt?e[n]=ct(t[n]||(t[n]=k()),i):t[n]=null}return e};class lt{constructor(e,n,s){this.s=e,this.t=n,this.v=s}toDOM(e=k()){return ct(e,this)}}const Lt=new WeakMap;var Fe=(t,e)=>{const n=Lt.get(t)||tt(Lt,t,k()),{b:s}=n;return s!==(typeof e=="function"?e():e).toDOM(n)&&t.replaceChildren(n.b.valueOf()),t};/*! (c) Andrea Giammarchi - MIT */const He=(t=>(e,...n)=>new lt(t,e,n))(!1);var b={uhtml:{render:Fe,html:He},globals:{now:Date.now,setTimeout,random:Math.random,DocumentFragment}};const{now:_t,setTimeout:Be}=b.globals,zt=1e3/60,Pt=(t,e)=>{const n=_t(),s=t();Be(()=>{const i=_t()<n+zt?e+1:Math.max(e-1,1);Pt(s,i)},e)};var d={title:{title:{}},main:{programWindowOpening:{},programming:{},programWindowClosing:{},running:{}},result:{caseResult:{},totalResult:{}}};const Dt=32,R=32,je=.2,dt=.06666666666666667,Ut=1/15,Ft=45,pt=30;var ut=t=>{let e=t;const n=new Map;return{next:s=>{e=s(e),n.forEach(i=>i(e))},subscribe:s=>{s(e);const i={};return n.set(i,s),i},unsubscribe:s=>n.delete(s)}};const{random:Ve}=b.globals,x=()=>[...Array(10)].map(()=>Math.round(Ve())),$t=ut(x()),Ge=t=>{$t.next(e=>e.map((n,s)=>{const i=t[s];return n===i?n:Math.min(Math.max(n-Ut,i),n+Ut)}))},{render:qe,html:Xe}=b.uhtml,{DocumentFragment:Ze}=b.globals,m=(t,e)=>{const n=new Ze,s=r=>qe(n,e(Xe)(r));let i=t;return{render:()=>s(i),update:r=>{i={...i,...r(i)},s(i)}}},Je=t=>t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),u=t=>Object.entries(t).reduce((e,[n,s])=>`${e}${Je(n)}:${s};`,""),Ke={number:1,timeLeft:0,score:0},ht="min(3vw, 4.2vh)",Qe=u({position:"absolute",top:"1%",left:"1%",fontSize:ht,color:"white",fontFamily:"serif"}),Ye=u({fontSize:`calc(${ht} * 0.7)`}),tn=u({position:"absolute",bottom:"1%",left:"1%",fontSize:ht,color:"white",fontFamily:"serif"}),mt=t=>[...t.toString()].reduceRight(([e,n],s)=>e.length===3?[s,`,${e}${n}`]:[`${s}${e}`,n],["",""]).join``,Ht=t=>(t*100|0).toString().padStart(4,"0").replace(/^(..)(..)/,"$1.$2"),W=m(Ke,t=>({number:e,timeLeft:n,score:s})=>t`<div style=${Qe}>No.${e}<span style=${Ye}>/${Dt}</span><br>${Ht(n)}</div><div style=${tn}>Score: ${mt(s)}</div>`),en=(t,e)=>m({bit:t},n=>({bit:s})=>{const i=255*s,r=255-i,a=u({display:"inline-block",width:e,height:e,lineHeight:e,fontSize:e,textAlign:"center",backgroundColor:`rgb(${i},${i},${i})`,color:`rgb(${r},${r},${r})`});return n`<div style=${a}>${s<.5?0:1}</div>`});var L=(t,e)=>{const n={tape:x(),style:{}},s=`min(${t}vw, ${e}vh)`,i=n.tape.map(r=>en(r,s));return m(n,r=>({tape:a,style:o})=>{const c=u({width:`calc(${s} * 10)`,height:s,...o});return i.forEach((p,l)=>p.update(()=>({bit:a[l]}))),r`<div style=${c}>${i.map(p=>p.render())}</div>`})};const Bt=L(15,30),jt=m({position:0},t=>({position:e})=>{const n=u({position:"absolute",top:"30%",left:"50%",transform:`translateX(calc(-5% - ${e} * 10%))`});return t`<div style=${n}>${Bt.render()}</div>`});$t.subscribe(t=>Bt.update(()=>({tape:t})));const _=[...Array(10)].map((t,e)=>({direction:1,nextChar:e&1,nextState:e>>1})),M=ut(_),gt=(t,e)=>M.next(n=>[...n.slice(0,t),e(n[t]),...n.slice(t+1)]),nn=(t,e)=>({state0:t,char0:e,direction:1,char1:e,state1:t,disabled:!1}),sn=u({display:"inline-block",margin:"1% 1%",textAlign:"center",whiteSpace:"nowrap"}),rn=t=>t<0?"L":"R",on=["0","1","2","3","4","A"],an=(t,e)=>()=>{gt(t,n=>({...n,direction:-e}))},cn=(t,e)=>()=>{gt(t,n=>({...n,nextChar:1-e}))},ln=(t,e)=>()=>{gt(t,n=>({...n,nextState:(e+1)%6}))};var dn=t=>m(nn(t>>1,t&0),e=>({state0:n,char0:s,direction:i,char1:r,state1:a,disabled:o})=>e`<div style=${sn}>${`<${n},${s},`}<button onclick=${an(t,i)} .disabled=${o}>${rn(i)}</button>${","}<button onclick=${cn(t,r)} .disabled=${o}>${r}</button>${","}<button onclick=${ln(t,a)} .disabled=${o}>${on[a]}</button>${">"}</div>`);const Vt=ut([]),z=t=>Vt.next(e=>[...e,t]),P=()=>{let t;return Vt.next(([e,...n])=>(t=e,n)),t},g={reset:{},halt:{},pass:{},run:{},goNext:{}},pn={style:{display:"none"},disabled:!0},ft=[...Array(10)].map((t,e)=>dn(e)),D="min(4vw, 6vh)",un=t=>u({position:"absolute",top:"29%",left:"50%",transform:"translate(-50%, 0)",width:`calc(${D} * 20)`,padding:"5px 0 10px 0",textAlign:"center",fontSize:D,lineHeight:D,border:"1px solid #999",backgroundColor:"rgba(51, 51, 153, 0.8)",color:"white",fontFamily:"Courier New",...t}),$n=u({marginBottom:"10px"}),bt=`calc(${D} * 1.3)`,hn=u({height:bt,marginTop:"0.1em",padding:"0 1em",fontSize:bt,lineHeight:bt,borderRadius:`calc(${D} * 0.15)`}),q=m(pn,(({onClickRunButton:t})=>e=>({style:n,disabled:s})=>(ft.forEach(i=>i.update(()=>({disabled:s}))),e`<div style=${un(n)}><span style=${$n}>Program</span><div>${ft.map(i=>i.render())}</div><button style=${hn} .disabled=${s} onclick=${t}>RUN</button></div>`))({onClickRunButton:()=>{z(g.run),q.update(()=>({disabled:!0}))}}));M.subscribe(t=>{t.forEach(({direction:e,nextChar:n,nextState:s},i)=>ft[i].update(()=>({state0:i>>1,char0:i&1,direction:e,char1:n,state1:s})))});const{now:mn}=b.globals,Gt=({startedAt:t})=>{const e=Math.max(R-(mn()-t)/1e3,0);W.update(()=>({timeLeft:e}))},gn=(t,e)=>{const n=e-t,s=n*je;return dt<Math.abs(s)?t+s:t+Math.min(Math.max(-dt,n),dt)},U=({currentTape:t,position:e})=>{Ge(t),jt.update(({position:n})=>({position:gn(n,e)}))},qt=(t,e)=>{const n=Math.max((1-t/20)*50,0),s=Math.min((1+t/20)*50,100),i=Math.min(Math.max((t-30)/10,0)*87+13,100);q.update(()=>({style:{clipPath:`polygon(${n}% 0, ${s}% 0, ${s}% ${i}%, ${n}% ${i}%)`},disabled:e}))},fn=t=>u({display:t===0?"none":"block",position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.6)",opacity:t}),bn=()=>z(g.goNext);var S=m({opacity:0},t=>({opacity:e})=>t`<div style=${fn(e)} onclick=${bn}></div>`);const xn={state:0},yn=t=>"E01234AH"[t+1],w="min(15vw, 30vh)",X=`calc(${w} / 16)`,wn=u({position:"absolute",top:"30%",left:`calc(50% - ${w} * 9 / 16)`}),Xt={position:"absolute",height:w,background:"radial-gradient(#aaa, #666)"},Zt={...Xt,width:`calc(${w} / 8)`,borderRadius:`${X} ${X} 0 0`},vn=u(Zt),Sn=u({...Zt,left:w}),An=u({...Xt,top:w,width:`calc(${w} * 9 / 8)`,borderRadius:`0 0 ${X} ${X}`,fontSize:`calc(${w} * 0.8)`,lineHeight:w,textAlign:"center",color:"white"}),A=m(xn,t=>({state:e})=>t`<div style=${wn}><div style=${vn} /><div style=${Sn} /><div style=${An}>${yn(e)}</div></div>`),y={pass:{},solved:{},timeup:{}},Tn={type:y.pass,commandsSaved:0,accepted:!1,steps:0,timeLeft:0,opacity:0},Mn=t=>u({display:t===0?"none":"block",position:"absolute",top:"10%",width:"100%",textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}),En=new Map([[y.pass,"#ccc"],[y.solved,"#cfc"],[y.timeup,"#ccf"]]),Z="min(4vw, 6vh)",Cn=t=>u({color:En.get(t),fontSize:`calc(${Z} * 1.3)`}),Nn=new Map([[y.pass,"Pass"],[y.solved,"Solved!"],[y.timeup,"Time's up."]]),In=u({display:"inline-block",margin:`${Z} 0`,fontSize:Z,color:"white"}),kn=u({fontSize:Z}),Jt=(t,e,n,s)=>(t+(e?1:0))*100*n*.1*(s/R)*3|0,J=m(Tn,t=>({type:e,commandsSaved:n,accepted:s,steps:i,timeLeft:r,opacity:a})=>t`<div style=${Mn(a)}><div style=${Cn(e)}>${Nn.get(e)}</div><table style=${In}><tr><td>Saved + accepted</td><td /><td>Steps</td><td /><td>Time left</td></tr><tr><td>((${n} + ${s?1:0}) &times; 100)</td><td>&times;</td><td>(${i} &times; 0.1)</td><td>&times;</td><td>(${Ht(r)} / ${R}.00 &times; 3)</td></tr></table><div style=${kn}>Score: +${mt(Jt(n,s,i,r))}</div></div>`),On={finished:!1,order:Array(10).fill(0),tape:Array(10).fill(0),score:0,opacity:0},E="min(4vw, 6vh)",Rn=t=>u({display:t===0?"none":"block",position:"absolute",top:"10%",width:"100%",fontSize:E,lineHeight:E,textAlign:"center",color:"white",opacity:t,filter:"drop-shadow(0 0 0.3rem black)"}),Wn=t=>u({marginBottom:E,fontSize:`calc(${E} * 1.3)`,color:t?"#fc9":"#c99"}),xt=L(4,6),yt=L(4,6),Ln={display:"inline-block"};[xt,yt].forEach(t=>t.update(()=>({style:Ln})));const _n=u({fontSize:E,marginTop:E}),wt=m(On,t=>({finished:e,caseNumber:n,order:s,tape:i,score:r,opacity:a})=>{xt.update(()=>({tape:s})),yt.update(()=>({tape:i}));const o=`display:${e?"none":"block"}`,c=e?"":`at No.${n}`;return t`<div style=${Rn(a)}><div style=${Wn(e)}>${e?"Finished!":"Game Over"}</div><div style=${o}>${c}</div>${e?"":xt.render()}<br>${e?"":yt.render()}<br><div style=${_n}>Total score: ${mt(r)}</div></div>`}),{now:zn}=b.globals,Kt=(t,e,n)=>({type:t,time:0,accepted:e,timeLeft:n}),Pn=(t,e)=>(t*6+e)/7|0,Dn=t=>({executedIndices:e,steps:n,caseNumber:s,score:i})=>{const{time:r,type:a,accepted:o,timeLeft:c}=t;S.update(()=>({opacity:Math.min(r/10,1)})),J.update(()=>({opacity:Math.min(Math.max(0,(r-10)/30),1)})),r===0&&(J.update(()=>({type:a,commandsSaved:10-e.size,accepted:o,steps:n,timeLeft:c})),q.update(()=>({disabled:!0}))),W.update(({score:l})=>({score:r===40?i:Pn(l,i)}));const p=P();if(r>=40&&p===g.goNext){if(J.update(()=>({opacity:0})),s===Dt)return{nextId:d.result.totalResult,nextArgs:[!0,0]};const l=s+1;W.update(()=>({number:l}));const $=x();return S.update(()=>({opacity:0})),M.next(()=>_),A.update(()=>({state:0})),{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:l,order:x(),originalTape:$,currentTape:$,position:0,machineState:0,executedIndices:new Map,startedAt:zn()}}}return{nextId:d.result.caseResult,nextArgs:[{...t,time:r+1}],stateUpdate:r===0?{score:i+Jt(10-e.size,o,n,c)}:{}}},Un=(t,e)=>({order:n,originalTape:s,score:i,caseNumber:r})=>{const a=P();return e<=40?(S.update(()=>({opacity:Math.min(e/10,1)})),wt.update(()=>({opacity:Math.max(0,(e-10)/30),finished:t,score:i,caseNumber:r,order:n,tape:s})),{nextId:d.result.totalResult,nextArgs:[t,e+1]}):e===41?{nextId:d.result.totalResult,nextArgs:[t,a===g.goNext?42:41]}:e<=61?(wt.update(()=>({opacity:(61-e)/20})),{nextId:d.result.totalResult,nextArgs:[t,e+1]}):{nextId:d.title.title,nextArgs:[0]}},Qt=L(5,7),Yt=L(5,7),te=t=>Qt.update(()=>({tape:t})),Fn=u({position:"absolute",top:"3%",width:"100%",fontFamily:"serif",color:"white"}),Hn=u({margin:"0 auto",fontSize:"min(3vw, 4.2vh)",lineHeight:"min(3vw, 4.2vh)"}),Bn=m({},t=>()=>t`<div style=${Fn}><table style=${Hn}><tr><td>ORDER:</td><td>${Qt.render()}</td></tr><tr><td>TAPE:</td><td>${Yt.render()}</td></tr></table></div>`);$t.subscribe(t=>Yt.update(()=>({tape:t})));const jn={running:!1,disabled:!0},Vn=u({display:"table-cell",position:"absolute",top:"19%",width:"100%",height:"10%",textAlign:"center",verticalAlign:"middle",fontFamily:"Courier New"}),F="min(5vw, 6.5vh)",ee=u({margin:`calc(5vh - ${F} / 2) 0.5em`,width:`calc(${F} * 5)`,height:F,fontSize:F,borderRadius:`calc(${F} * 0.15)`}),Gn=()=>z(g.reset),qn=()=>z(g.halt),Xn=()=>z(g.pass),vt=m(jn,t=>({running:e,disabled:n})=>t`<div style=${Vn}><button style=${ee} onclick=${e?qn:Gn} .disabled=${n}>${e?"HALT":"RESET"}</button><button style=${ee} onclick=${Xn} .disabled=${n||e}>PASS</button></div>`),{now:K}=b.globals,Q=(t,e)=>Math.max(R-(t-e)/1e3,0),Zn=t=>e=>{te(e.order);const n=t<Ft;return qt(t,n),U(e),vt.update(()=>({running:!1,disabled:n})),Gt(e),n?{nextId:d.main.programWindowOpening,nextArgs:[t+1]}:{nextId:d.main.programming,nextArgs:[]}},Jn=()=>t=>{U(t),Gt(t);const e=P();return e===g.run?(A.update(()=>({state:0})),{nextId:d.main.programWindowClosing,nextArgs:[Ft],stateUpdate:{currentTape:t.originalTape,machineState:0,position:0,runAt:K()}}):(e===g.reset&&M.next(()=>_),e===g.pass?{nextId:d.result.caseResult,nextArgs:[Kt(y.pass,!1,Q(K(),t.startedAt))],stateUpdate:{steps:0}}:{nextId:d.main.programming,nextArgs:[],stateUpdate:e===g.reset?{currentTape:t.originalTape,machineState:0,position:0}:{}})},Kn=t=>e=>(qt(t,!0),U(e),vt.update(()=>({running:t===0,disabled:t>0})),t===0?{nextId:d.main.running,nextArgs:[0],stateUpdate:{steps:0,executedIndices:new Set}}:{nextId:d.main.programWindowClosing,nextArgs:[t-1]});let ne=_;M.subscribe(t=>{ne=t});const Qn=({currentTape:t,position:e,machineState:n,steps:s,executedIndices:i})=>{const r=n<<1|t[e],{direction:a,nextChar:o,nextState:c}=ne[r];return{currentTape:[...t.slice(0,e),o,...t.slice(e+1)],position:e+a,machineState:c,steps:s+1,executedIndices:new Set([...i,r])}},Yn=t=>e=>{const{position:n,machineState:s,startedAt:i,runAt:r,order:a,currentTape:o}=e;if(P()===g.halt)return A.update(()=>({state:6})),Q(K(),i)>0?{nextId:d.main.programWindowOpening,nextArgs:[0]}:{nextId:d.result.totalResult,nextArgs:[!1,0]};U(e);const c=n<0||n>=10?-1:s;if([-1,5].includes(c)&&t===pt){if(A.update(()=>({state:c})),a.join``===o.join``){const p=Q(r,i),l=p>0?y.solved:y.timeup;return{nextId:d.result.caseResult,nextArgs:[Kt(l,c===5,p)]}}return Q(K(),i)>0?{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{machineState:c}}:{nextId:d.result.totalResult,nextArgs:[!1,0]}}return A.update(()=>({state:s})),{nextId:d.main.running,nextArgs:[t===pt?0:t+1],stateUpdate:t===0?Qn(e):{}}},ts={opacity:0},es=t=>u({display:t===0?"none":"block",position:"absolute",width:"100%",top:"30%",textAlign:"center",color:"white",opacity:t}),ns=u({fontSize:"min(12vw, 18vh)",color:"orange"}),Y=m(ts,t=>({opacity:e})=>t`<div style=${es(e)}><div style=${ns}>TMP</div></div>`),{now:ss,random:St}=b.globals;var se=(t=0,e=0)=>({currentTape:n,position:s,machineState:i})=>{if(t===0){const a=x();return te(a),W.update(()=>({number:1,timeLeft:R,score:0})),S.update(()=>({opacity:1})),{nextId:d.title.title,nextArgs:[1],stateUpdate:{position:0,machineState:0,order:a,currentTape:x()}}}if(U({currentTape:n,position:s}),A.update(()=>({state:i})),t<30)return Y.update(()=>({opacity:t/30})),{nextId:d.title.title,nextArgs:[t+1]};if(t===30)return{nextId:d.title.title,nextArgs:[P()===g.goNext?31:30,(e+1)%pt],stateUpdate:e===0?{currentTape:[...n.slice(0,s),Math.round(St()),...n.slice(s+1,10)],position:{0:1,9:8}[s]||s+(St()<.5?-1:1),machineState:Math.floor(St()*5)}:{}};if(t<50){const a=(50-t)/20;return Y.update(()=>({opacity:a})),S.update(()=>({opacity:a})),{nextId:d.title.title,nextArgs:[t+1]}}Y.update(()=>({opacity:0})),S.update(()=>({opacity:0})),M.next(()=>_);const r=x();return{nextId:d.main.programWindowOpening,nextArgs:[0],stateUpdate:{caseNumber:1,score:0,order:x(),originalTape:r,currentTape:r,position:0,machinState:0,executedIndices:new Map,startedAt:ss()}}};const{now:is}=b.globals,rs=new Map([[d.title.title,se],[d.main.programWindowOpening,Zn],[d.main.programming,Jn],[d.main.programWindowClosing,Kn],[d.main.running,Yn],[d.result.caseResult,Dn],[d.result.totalResult,Un]]),os=(t,e)=>({score:0,caseNumber:1,order:t,originalTape:e,currentTape:e,position:0,machineState:0,startedAt:is(),runAt:null,steps:0,executedIndices:new Set}),ie=(t,e)=>()=>{const{nextId:n,nextArgs:s,stateUpdate:i}=t(e);return ie(rs.get(n)(...s),{...e,...i})},{render:as,html:cs}=b.uhtml;as(document.getElementById("root"),cs`${[W,Bn,jt,A,vt,q,S,J,wt,Y].map(t=>t.render())}`),Pt(ie(se(0),os(x(),x())),zt)})();
